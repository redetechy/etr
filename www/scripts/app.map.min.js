function strDefault(e,t){return null==e?t:""==e.trim()?t:e}function strEncode(e){return e?encodeURIComponent(e):""}function strDecode(e){return e?decodeURIComponent(e):""}function escapeText(e){if(!e)return"";for(var t="",a=0;a<e.length;a++){var n=e.charAt(a);t+="<"==n?"&lt;":">"==n?"&gt;":"&"==n?"&amp;":"'"==n?"&#39;":n}return t}function parseHexChar(e){var t=numParseHex(e,-1);if(-1==t)return"";if(t<=65535)return String.fromCharCode(t);if(t<=1114111){var a=55296|(t-=65536)>>10&1023,n=56320|1023&t;return String.fromCharCode(a,n)}return"?"}function decodeUnicode(e){return e=(e=e.replace(/\\U([A-Fa-f0-9]{8})/g,function(e,t){return parseHexChar(t)})).replace(/\\u([A-Fa-f0-9]{4})/g,function(e,t){return parseHexChar(t)})}function decodeUTF8(e){return decodeURIComponent(escape(e))}function encodeUTF8(e){return unescape(encodeURIComponent(e))}function _trimZeros(e){if("string"==typeof e){for(;e.startsWith(" ");)e=e.substring(1);for(;1<e.length&&e.startsWith("0");)e=e.substring(1)}return e}function numParseHex(e,t){var a=parseInt(e,16);return isNaN(a)&&(a=t),a}function numParseInt(e,t){var a=parseInt(_trimZeros(e));return isNaN(a)&&(a=t),a}function numParseFloat(e,t){var a=parseFloat(_trimZeros(e));return isNaN(a)&&(a=t),a}function numFormatFloat(e,t){var a=numParseFloat(e,0);if(0<t){var n,i=0<=a?"":"-";for(a=Math.abs(a),n=0;n<t;n++)a*=10;a=parseInt(a+.5);for(var s=new String(a);s.length<=t;)s="0"+s;return i+(s=s.substring(0,s.length-t)+"."+s.substring(s.length-t))}return a=parseInt(0<=a?a+.5:a-.5),new String(a)}String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.startsWith=function(e){try{return!e||""==e||!(e.length>this.length)&&e===this.substr(0,e.length)}catch(e){return!1}},String.prototype.endsWith=function(e){try{if(!e||""==e)return!0;if(e.length>this.length)return!1;var t=this.length;return e===this.substr(t-e.length,t)}catch(e){return!1}},String.prototype.contains=function(e){try{return e&&""!=e?!(e.length>this.length)&&0<=this.indexOf(e):0==this.length}catch(e){return!1}};var EARTH_RADIUS_KM=6371.0088,EARTH_RADIUS_METERS=1e3*EARTH_RADIUS_KM;function geoIsValid(e,t){return!(!e&&!t)&&(1e-4<e||e<-1e-4||(1e-4<t||t<-1e-4))}function geoSQ(e){return e*e}function geoRadians(e){return e*(Math.PI/180)}function geoDegrees(e){return e*(180/Math.PI)}function geoDistanceRadians(e,t,a,n){var i=geoRadians(e),s=geoRadians(t),o=geoRadians(a),r=o-i,l=geoRadians(n)-s,p=geoSQ(Math.sin(r/2))+Math.cos(i)*Math.cos(o)*geoSQ(Math.sin(l/2));return 2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p))}function geoDistanceMeters(e,t,a,n){return geoDistanceRadians(e,t,a,n)*EARTH_RADIUS_METERS}function geoHeading(e,t,a,n){var i=geoRadians(e),s=geoRadians(t),o=geoRadians(a),r=geoRadians(n),l=geoDistanceRadians(e,t,a,n),p=Math.acos((Math.sin(o)-Math.sin(i)*Math.cos(l))/(Math.sin(l)*Math.cos(i)));return Math.sin(r-s)<0&&(p=2*Math.PI-p),geoDegrees(p)}function geoRadiusPoint(e,t,a,n){for(;n<0;)n+=360;for(;360<=n;)n-=360;var i=geoRadians(e),s=geoRadians(t),o=a/EARTH_RADIUS_METERS,r=geoRadians(n),l=Math.asin(Math.sin(i)*Math.cos(o)+Math.cos(i)*Math.sin(o)*Math.cos(r)),p=s+Math.atan2(Math.sin(r)*Math.sin(o)*Math.cos(i),Math.cos(o)-Math.sin(i)*Math.sin(l));return{lat:geoDegrees(l),lon:geoDegrees(p)}}var cookieTag="OpenGTS";function setCookie(e,t){var a;if(null==t)a=new Date(0).toGMTString(),t="";else{a=new Date((new Date).getTime()+9e5)}document.cookie=cookieTag+"."+e+"="+strEncode(t)+";; expires="+a}function getCookie(e,t){var a=document.cookie,n=cookieTag+"."+e+"=",i=a.indexOf(n);if(0<=i){var s=a.indexOf(";",i);return s<0&&(s=a.length),strDecode(a.substring(i+n.length,s))}return t}function getQueryArg(e){var t=window.location.search.split("?");if(1<t.length){var a=t[1].split("&");for(i in a){var n=a[i].split("=");if(e==n[0])return n[1]}}return null}function getElementPosition(e){for(var t=0,a=0,n=e;n;)t+=n.offsetLeft,a+=n.offsetTop,n=n.offsetParent;return 0<=navigator.userAgent.indexOf("Mac")&&void 0!==document.body.leftMargin&&(t+=document.body.leftMargin,a+=document.body.topMargin),{left:t,top:a}}function getElementSize(e){return{width:e.offsetWidth,height:e.offsetHeight}}function openResizableWindow(e,t,a,n){var i="resizable=yes";if(i+=",menubar=no,toolbar=no",0<a&&0<n){i+=",width="+a+",height="+n;var s=(screen.width-a)/2,o=(screen.height-n)/2;i+=",screenX="+s+",screenY="+o+",left="+s+",top="+o}i+=",status=yes,scrollbars=yes";var r=window.open(e,t,i,!1);return r?(void 0!==r.focus&&r.focus(),r):null}function openFixedWindow(e,t,a,n){var i="resizable=no";if(i+=",menubar=no,toolbar=no",0<a&&0<n){i+=",width="+a+",height="+n;var s=(screen.width-a)/2,o=(screen.height-n)/2;i+=",screenX="+s+",screenY="+o+",left="+s+",top="+o}i+=",status=no,scrollbars=no";var r=window.open(e,t,i,!1);return r?(void 0!==r.focus&&r.focus(),r):null}function openURL(e,t){t||(t="_top"),window.open(e,t)}function rgbHex(e,t,a){return(520093696|(255&e)<<16|(255&t)<<8|255&a).toString(16).toUpperCase().substr(2,6)}function rgbVal(rgb){try{rgb.startsWith("#")&&(rgb=rgb.substr(1));var Rx=rgb.substr(0,2),Gx=rgb.substr(2,2),Bx=rgb.substr(4,2),rgb=eval("[ 0x"+Rx+", 0x"+Gx+", 0x"+Bx+" ]");return{R:rgb[0],G:rgb[1],B:rgb[2]}}catch(e){return{R:0,G:0,B:0}}}function rgbLighter(e,t){try{var a=parseInt(e.R+(255-e.R)*t+.5),n=parseInt(e.G+(255-e.G)*t+.5),i=parseInt(e.B+(255-e.B)*t+.5);return{R:a=a<0?0:255<a?255:a,G:n=n<0?0:255<n?255:n,B:i=i<0?0:255<i?255:i}}catch(e){return{R:0,G:0,B:0}}}function rgbDarker(e,t){try{var a=parseInt(e.R-e.R*t+.5),n=parseInt(e.G-e.G*t+.5),i=parseInt(e.B-e.B*t+.5);return{R:a=a<0?0:255<a?255:a,G:n=n<0?0:255<n?255:n,B:i=i<0?0:255<i?255:i}}catch(e){return{R:0,G:0,B:0}}}function createDivBox(e,t,a,n,i){/Safari/.test(navigator.userAgent);var s=document.createElement("div");return s.id=e,s.name=e,s.className=e,s.style.left=t+"px",s.style.top=a+"px",0<n&&(s.style.width=n+"px"),0<i&&(s.style.height=i+"px"),s.style.position="absolute",s.style.cursor="default",s.style.zIndex=3e4,s.style.overflow="auto",s}function getKeyCode(e){var t=0;try{t=document.layers?e.which:document.all?e.keyCode:document.getElementById?e.keyCode||e.which:0}catch(e){t=0}return t}function getKeyString(e){var t=getKeyCode(e);return String.fromCharCode(t)}function isDigitKeyPressed(e){var t=getKeyCode(e);return 48<=t&&t<=57}function isEnterKeyPressed(e){return 13==getKeyCode(e)}function ignoreEnterKeyPress(e){return!isEnterKeyPressed(e)||(e.keyCode=0,!1)}function getXMLHttpRequest(){var t=null;if(window.XMLHttpRequest)try{t=new XMLHttpRequest}catch(e){t=null}else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=null}}else t=null;return t}var AJAXRequestInProcess=0;function sendAJAXRequest(e){var t=e.method,a="POST"==t||"post"==t,n=e.url,i=a?e.postData:"",s=a?"application/jsonrequest":"",o=e.callBack;try{var r=getXMLHttpRequest();return r?(r.open(a?"POST":"GET",n,!0),r.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"),a&&(r.setRequestHeader("Content-Type",s),r.setRequestHeader("Content-Length",i.length),r.setRequestHeader("Connection","close")),r.onreadystatechange=function(){if(4==r.readyState){var e=r.responseText;if(o)try{o(e)}catch(e){}else alert("AJAX Response:\n"+e);AJAXRequestInProcess--}else 1==r.readyState||AJAXRequestInProcess--},r.send(a?i:null),AJAXRequestInProcess++,!0):(alert("Error [sendAJAXRequest_POST]:\n"+n),!1)}catch(e){return alert("Error [sendAJAXRequest_POST]:\n"+e),!1}}function createXMLDocument(e){try{return(a=new ActiveXObject("Microsoft.XMLDOM")).async="false",a.loadXML(e),a}catch(t){try{var a;return a=(new DOMParser).parseFromString(e,"text/xml")}catch(e){return alert("Error loading XML: "+t.message),null}}}function getXMLNodeAttribute(e,t,a){var n=e.getNamedItem(t);return null!=n?n.nodeValue:a}function getCheckedRadioValue(e){try{if(e){var t=e.length;if(null==t){if(e.checked)return e.value}else for(var a=0;a<t;a++)if(e[a].checked)return e[a].value}}catch(e){}return""}function setCheckedRadioValue(e,t){try{if(e){var a=e.length;if(null==a)return e.checked=e.value==t.toString(),!0;for(var n=0;n<a;n++)if(e[n].value==t.toString())return e[n].checked=!0}}catch(e){}return!1}function imageGetBatterLevelURL(e){return e<=0?"images/Batt000.png":(e<1&&(e*=100),e<26?"images/Batt025.png":e<51?"images/Batt050.png":e<71?"images/Batt070.png":e<91?"images/Batt090.png":"images/Batt100.png")}function playSound(e,t,a){var n=document.getElementById(e);null!=n&&(n.innerHTML="<embed src='"+t+"' hidden='true' autostart='true' loop='"+a+"'>")}function getObjectToString(e){return e&&e.constructor&&e.constructor.toString?e.constructor.toString():""}function getClassName(e){var t=getObjectToString(e);if(obdStr&&""!=t){var a=obdStr.match(/funtion\s*(\w+)/);return a&&1<a.length?a[1]:""}return""}var b64Alpha="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64Pad="=";function decodeBase64(e){try{for(var t=e.length;0<t&&e.charAt(t-1)==b64Pad;)t--;(t-1)%4==0&&0;for(var a="",n=0;n<t;){var i=b64Alpha.indexOf(e.charAt(n++)),s=n<t?b64Alpha.indexOf(e.charAt(n++)):-1,o=n<t?b64Alpha.indexOf(e.charAt(n++)):-1,r=n<t?b64Alpha.indexOf(e.charAt(n++)):-1,l=0<=i&&0<=s?(63&i)<<2|(48&s)>>4:-1,p=0<=s&&0<=o?(15&s)<<4|(60&o)>>2:-1,h=0<=o&&0<=r?(3&o)<<6|(63&r)>>0:-1;0<=l&&(a+=String.fromCharCode(l)),0<=p&&(a+=String.fromCharCode(p)),0<=h&&(a+=String.fromCharCode(h))}return unescape(a)}catch(e){return""}}var DATA_RESPONSE_LOGOUT="LOGOUT",DATA_RESPONSE_ERROR="ERROR",DATA_RESPONSE_PING_OK="PING:OK",DATA_RESPONSE_PING_ERROR="PING:ERROR",CLASS_DETAILS_DIV="trackMapDetailLocation",CLASS_DETAILS_TABLE_N="mapDetailsTable",CLASS_DETAILS_TABLE_S="mapDetailsTable_sortable",CLASS_DETAILS_HEADER_ROW="mapDetailsHeaderRow",CLASS_DETAILS_HEADER_COL_N="mapDetailsHeaderColumn_nosort",CLASS_DETAILS_HEADER_COL_S="mapDetailsHeaderColumn_sort",CLASS_DETAILS_ROW_HILITE="mapDetailsDataRowHiLite",CLASS_DETAILS_ROW_ODD="mapDetailsDataRowOdd",CLASS_DETAILS_ROW_EVEN="mapDetailsDataRowEven",CLASS_DETAILS_INDEX_COL="mapDetailsIndexColumn",CLASS_DETAILS_DATA_COL_NEW="mapDetailsDataColumn_new",CLASS_DETAILS_DATA_COL="mapDetailsDataColumn",ID_DETAIL_ROW_="detailRow_",DETAILS_WINDOW=!1,jsvDetailsWindow=null,jsvDetailsLastHilightedRow=null,jsvUseDeviceBreaks=!1,REPLAY_STOPPED=0,REPLAY_PAUSED=1,REPLAY_RUNNING=2,RECENTER_NONE=0,RECENTER_LAST=1,RECENTER_ALL=2,RECENTER_PAN=3,RECENTER_ZOOM=RECENTER_LAST,ZONE_POINT_RADIUS=0,ZONE_BOUNDED_RECT=1,ZONE_SWEPT_POINT_RADIUS=2,ZONE_POLYGON=3,JSON_JMapData="JMapData",JSON_Time="Time",JSON_LastEvent="LastEvent",JSON_DataColumns="DataColumns",JSON_Data="Data",JSON_Shapes="Shapes",JSON_DataSets="DataSets",JSON_Points="Points",JSON_Actions="Actions",JSON_cmd="cmd",JSON_arg="arg",TAG_MapData="MapData",TAG_Action="Action",TAG_Time="Time",TAG_LastEvent="LastEvent",TAG_DataSet="DataSet",TAG_Point="P",TAG_Shape="Shape",TAG_Geozone="Geozone",ATTR_isFleet="isFleet",ATTR_type="type",ATTR_routeColor="routeColor",ATTR_textColor="textColor",ATTR_color="color",ATTR_desc="desc",ATTR_ppNdx="ppNdx",ATTR_id="id",ATTR_route="route",ATTR_timestamp="timestamp",ATTR_timezone="timezone",ATTR_year="year",ATTR_month="month",ATTR_day="day",ATTR_command="command",ATTR_radius="radius",ATTR_battery="battery",ATTR_signal="signal",jsvPartialData=!1,jsvImageBaseDir=".",jsvFixedZoom=!1,LATLON_FORMAT_MIN_DEC=2,DISPLAY_COLOR_TYPE=1,ROUTE_COLOR_NONE="none",TEXT_LABEL_FONT_SIZE="11";function JSMapPoint(e,t){this.lat=e,this.lon=t}function JSMapShape(e,t,a,n,i,s,o){this.type=e,this.radius=t,this.points=a,this.color=n,this.zoomTo=i,this.desc=s,this.ppNdx=o}function JSBounds(){this.maxLat=-90,this.maxLon=-180,this.minLat=90,this.minLon=180}function addBaseHrefToIconUrl(e){return e?MAP_IMAGE_URL+"/"+e:e}function JSMapPushpin(e,t,a,n,i,s,o,r,l){this.rcdNdx=e,this.dsNdx=t,this.ppNdx=a,this.evRcd=n,this.show=!0,this.lat=i,this.lon=s,this.accRadM=0,this.isCellLoc=!1,null!=this.evRcd&&(this.accRadM=this.evRcd.accuracy,this.isCellLoc=this.evRcd.isCellLoc,this.isCellLoc&&this.accRadM<100&&(this.accRadM=100)),this.label=o,this.html=r,this.iconUrl=addBaseHrefToIconUrl(l.iconURL),this.iconSize=l.iconSize,this.iconHotspot=l.iconHotspot,this.shadowUrl=addBaseHrefToIconUrl(l.shadowURL),this.shadowSize=l.shadowSize,this.showDeviceLabel=l.showDeviceLabel,this.accRadius=null;var p=!!l.bgURL;this.bgUrl=p?addBaseHrefToIconUrl(l.bgURL):null,this.bgSize=p?l.bgSize:null,this.bgOffset=p?l.bgOffset:null,this.bgMarker=null,this.map=null,this.marker=null,this.hoverPopup=!1,this.popup=null,this.popupShown=!1}function getOnOff(e){return"Y"==e?"On":"N"==e?"Off":""}function JSMapDataSet(e,t,a,n){this.pushPins=e,this.routePoints=t,this.routeColor=a,this.partial=n}function JSDetailPoint(e,t,a,n,i){this.device=n.device,this.latlon=jsmFormatCoord(n.latitude,!0,4)+"/"+jsmFormatCoord(n.longitude,!1,4),this.satCount=n.satCount,this.dsNdx=t,this.ppNdx=a,this.index=e,this.code=n.code,this.timestamp=n.timestamp,this.dateTime=n.dateFmt+" "+n.timeFmt,this.timeZone=n.timeZone,this.speed=numFormatFloat(n.speedKPH*SPEED_KPH_MULT,1),this.heading=numFormatFloat(n.heading,0),this.compass=n.compass,this.altitude=n.altitude,this.address=n.address,this.optDesc=n.optDesc,this.color=i}function jsMapInit(){if(null==jsmap)if(jsmapElem=document.getElementById(MAP_ID),null!=jsmapElem)try{jsmap=new JSMap(jsmapElem),jsmap?(jsmap.JSClearLayers(),jsmap.JSDrawPushpins(null,RECENTER_ZOOM,0)):alert("[jsMapInit]: "+MAP_PROVIDER_NAME+"\nError occured while creating JSMap(map provider service may be temporarily unavailable)")}catch(e){alert("[jsMapInit]: "+MAP_PROVIDER_NAME+"\nError initializing map\n(map provider service may be temporarily unavailable)\n"+e)}else alert("[jsMapInit]: "+MAP_PROVIDER_NAME+"\nDiv '"+MAP_ID+"' not found")}function jsmUnload(){if(jsmap)try{jsmap.JSUnload()}catch(e){}}function jsmSetFixedZoom(e){jsvFixedZoom=e}function jsmRecenterZoomMode(e){return jsvFixedZoom?RECENTER_NONE:e}function jsmSetCenter(e,t,a){if(jsmap){var n=new JSMapPoint(e,t);jsmap.JSSetCenter(n,a)}}function jsmCenterOnLastPushpin(e){if(jsmap){if(jsmap.JSClearLayers(),jsvPoiPins&&0<jsvPoiPins.length&&jsmap.JSDrawPOI(jsvPoiPins),jsvDataSets&&0<jsvDataSets.length){var t=jsvDataSets[0];t.routePoints&&2<=t.routePoints.length&&t.routeColor!=ROUTE_COLOR_NONE&&jsmap.JSDrawRoute(t.routePoints,t.routeColor);var a=t.pushPins;if(a&&0<a.length)if(e){var n=[a[a.length-1]];jsmap.JSDrawPushpins(n,jsmRecenterZoomMode(RECENTER_ZOOM),REPLAY_STOPPED)}else jsmap.JSDrawPushpins(a,jsmRecenterZoomMode(RECENTER_ZOOM),REPLAY_STOPPED)}jsvDetailVisible=!1,jsmShowDetailReport()}}function _jsmSetMap(e,t,a,n){if(jsmap&&(jsmap.JSClearLayers(),jsvPoiPins=a,jsvPoiPins&&0<jsvPoiPins.length&&jsmap.JSDrawPOI(jsvPoiPins),jsvDataSets=t,jsvDataSets))for(var i=0;i<jsvDataSets.length;i++){var s=jsvDataSets[i];if(s.routePoints&&2<=s.routePoints.length&&s.routeColor!=ROUTE_COLOR_NONE&&jsmap.JSDrawRoute(s.routePoints,s.routeColor),s.pushPins&&0<s.pushPins.length){var o=i+1==jsvDataSets.length?e:RECENTER_NONE;jsmap.JSDrawPushpins(s.pushPins,jsmRecenterZoomMode(o),n)}if(0<n)break}}function jsmGetXMLHttpRequest(){return getXMLHttpRequest()}function jsmParseAJAXPoints(e,t,a){return e.startsWith("{")?jsmParseAJAXPoints_JSON(e,t,a):jsmParseAJAXPoints_XML(e,t,a)}function jsmParseAJAXPoints_JSON(e,t,a){var n=JSON.parse(e);if(null==n)return 0;var i=n.JMapData;if(null==i)return alert("JMapData not found in JSON response"),0;var s=i.isFleet,o=i.Time;null!=o&&(jsvTodayEpoch=o.timestamp,jsvTodayTmzFmt=o.timezone,jsvTodayYMD=o.YMD,jsvTodayDateFmt=o.date,jsvTodayTimeFmt=o.time);var r=i.LastEvent;null!=r?(jsvLastEventEpoch=r.timestamp,jsvLastEventTmzFmt=r.timezone,jsvLastEventYMD=r.YMD,jsvLastEventDateFmt=r.date,jsvLastEventTimeFmt=r.time,jsvLastBatteryLevel=r.battery,jsvLastSignalStrength=r.signal):(jsvLastBatteryLevel=0,jsvLastSignalStrength=0);var l=[],p=0,h=[],d=[],u=[],c=i.Shapes;if(null!=c&&0<c.length)for(var _=0;_<c.length;_++){for(var m=c[_],g=m.type,L=m.radius,E=m.color,f=m.desc,S=m.ppNdx,T=m.Points,M=[],A=0;A<T.length;A++){var v=T[A].split("/");if(!(v.length<2)){var D=numParseFloat(v[0],0),y=numParseFloat(v[1],0);0==D&&0==y||(M.push(new JSMapPoint(D,y)),D+"/"+y+", ")}}u.push(new JSMapShape(g,L,M,E,!1,f,S))}for(var C=0,P=0,R=null!=i.DataSets?i.DataSets:[],I=0;I<R.length;I++){var O=R[I],N=PUSHPINS_SHOW,b=0,j=[],w=!1,x="poi"==(g=strDefault(O.type,"device")),U=strDefault(O.id,""),F=ROUTE_LINE_SHOW,H=[],B=O.route,G=strDefault(O.textColor,""),k=strDefault(O.routeColor,"");""==k&&(k=ROUTE_LINE_COLOR),F&&(x||B||(F=!1));var Z=O.Points,J=0;Z.length-J>MAX_PUSH_PINS&&(J=Z.length-MAX_PUSH_PINS,w=!0);for(var z=0,V=null,X=null,Y=null,W=J;W<Z.length;W++){var K=Z[W],q=new MapEventRecord(K);if(q.valid)if(q.type=g,q.typeID=U,q.isFleet=s,x){q.validGPS&&(Q=jsmCreatePushPin(-1,-1,S=l.length,q))&&l.push(Q)}else{if(null!=X&&((X.nextEv=q).lastEv=X),0<(X=q).timestamp?(C++,q.index=C,z++):q.index=0,q.validGPS){if(F&&H.push(new JSMapPoint(q.latitude,q.longitude)),0<q.timestamp){SHOW_ADDR||null==q.address||(SHOW_ADDR=!0);var Q;S=b;jsmap.lastIconIdx=q.iconNdx,(Q=jsmCreatePushPin(C,p,S,q))&&(((V=Q).show=N)&&(V.show=!0,j.push(V)),d.push(new JSDetailPoint(C,p,b,q,G)),b++)}}else 0<q.timestamp&&d.push(new JSDetailPoint(C,-1,-1,q,G));if(q.stopped<0);else if(0==q.stopped){if(null!=Y){var $=q.timestamp-Y.timestamp;Y.stopSec=$}Y=null}else 2==q.stopped?Y=q:q.stopped;!IS_FLEET&&q.timestamp>jsvLastEventEpoch&&(jsvLastEventEpoch=q.timestamp,jsvLastEventYMD={YYYY:q.year,MM:q.month1,DD:q.day},jsvLastEventDateFmt=q.dateFmt,jsvLastEventTimeFmt=q.timeFmt,jsvLastEventTmzFmt=q.timeZone)}}if(!x){if(null!=Y&&0<jsvTodayEpoch){$=jsvTodayEpoch-Y.timestamp;Y.stopSec=$}N||null==V||(V.show=!0,j.push(V)),P<z&&(P=z),h.push(new JSMapDataSet(j,F?H:null,k,w)),p++}}if(jsvUseDeviceBreaks=1<h.length&&1<P,jsvDetailPoints=d,_jsmSetMap(t,h,l,a),u&&0<u.length)for(A=0;A<u.length;A++){var ee=u[A];jsmDrawShape(ee.type,ee.radius,ee.points,ee.color,ee.zoomTo,ee.desc,ee.ppNdx)}(jsvLastEventDateFmt&&jsvLastEventTimeFmt?(jsmSetIDInnerHTML(ID_LATEST_EVENT_DATE,jsvLastEventDateFmt),jsmSetIDInnerHTML(ID_LATEST_EVENT_TIME,jsvLastEventTimeFmt)):(jsmSetIDInnerHTML(ID_LATEST_EVENT_DATE,""),jsmSetIDInnerHTML(ID_LATEST_EVENT_TIME,TEXT_UNAVAILABLE)),jsmSetIDInnerHTML(ID_LATEST_EVENT_TMZ,jsvLastEventTmzFmt),IS_FLEET)||angular.element(document.getElementById("mainWrapperDiv")).scope().loadDeviceInfo(X);jsmSetIDInnerHTML(ID_LATEST_BATTERY,jsmBatteryLevelIMG(jsvLastBatteryLevel)),jsvPartialData=w,jsmSetIDInnerHTML(ID_MESSAGE_TEXT,jsvPartialData?TEXT_MAXPUSHPINS_MSG:""),jsmShowDetailReport();for(var te=null!=i.Actions?i.Actions:[],ae=0;ae<te.length;ae++){var ne=te[ae],ie=strDefault(ne.cmd,""),se=strDefault(ne.arg,"");if("autoupdate"==ie)try{"true"==se?startAutoUpdateMapTimer():stopAutoUpdateMapTimer()}catch(e){}else if("alert"==ie)alert(se);else if("gotourl"==ie)target="_self",openURL(se,target);else if("showpp"==ie){jsmShowDetailPushpin(0,se-1)}else if("zoompp"==ie){var oe=jsmGetPushpin(0,se-1);if(null!=oe){jsmSetCenter(D=oe.lat,y=oe.lon,-1)}}}return jsvDetailPoints.length}function jsmParseAJAXPoints_XML(e,t,a){var n=createXMLDocument(e);if(null==n)return 0;var i=n.getElementsByTagName(TAG_MapData);if(i.length<=0)return 0;var s=i[0],o=(getXMLNodeAttribute(s.attributes,ATTR_isFleet,!1),s.getElementsByTagName(TAG_LastEvent)),r=0<o.length?o[0].childNodes[0].nodeValue:null;if(null!=r){var l=o[0].attributes;jsvLastEventEpoch=numParseInt(getXMLNodeAttribute(l,ATTR_timestamp,0),0),jsvLastEventTmzFmt=getXMLNodeAttribute(l,ATTR_timezone,"");var p=getXMLNodeAttribute(l,ATTR_year,0),h=getXMLNodeAttribute(l,ATTR_month,0),d=getXMLNodeAttribute(l,ATTR_day,0),u=getXMLNodeAttribute(l,ATTR_battery,0),c=getXMLNodeAttribute(l,ATTR_signal,0);if(jsvLastEventYMD={YYYY:p,MM:h,DD:d},jsvLastBatteryLevel=u,jsvLastSignalStrength=c,0<(E=r.split("|")).length){var _=0<E.length?E[0]:"",m=1<E.length?E[1]:"";2<E.length&&E[2],3<E.length&&E[3];jsvLastEventDateFmt=_,jsvLastEventTimeFmt=m}}else jsvLastBatteryLevel=0,jsvLastSignalStrength=0;var g=s.getElementsByTagName(TAG_Time),L=0<g.length?g[0].childNodes[0].nodeValue:null;if(null!=L){l=g[0].attributes;jsvTodayEpoch=getXMLNodeAttribute(l,ATTR_timestamp,0),jsvTodayTmzFmt=getXMLNodeAttribute(l,ATTR_timezone,"");var E;p=getXMLNodeAttribute(l,ATTR_year,0),h=getXMLNodeAttribute(l,ATTR_month,0),d=getXMLNodeAttribute(l,ATTR_day,0);if(jsvTodayYMD={YYYY:p,MM:h,DD:d},0<(E=L.split("|")).length){_=0<E.length?E[0]:"",m=1<E.length?E[1]:"";jsvTodayDateFmt=_,jsvTodayTimeFmt=m}}for(var f=[],S=0,T=[],M=[],A=[],v=s.getElementsByTagName(TAG_Shape),D=0;D<v.length;D++){for(var y=v[D],C=y.attributes,P=getXMLNodeAttribute(C,ATTR_type,"none"),R=numParseFloat(getXMLNodeAttribute(C,ATTR_radius,0),0),I=getXMLNodeAttribute(C,ATTR_color,"#0000FF"),O=getXMLNodeAttribute(C,ATTR_desc,""),N=numParseInt(getXMLNodeAttribute(C,ATTR_ppNdx,0),0),b=y.childNodes[0].nodeValue.split(","),j=[],w=0;w<b.length;w++){var x=b[w].split("/");if(!(x.length<2)){var U=numParseFloat(x[0],0),F=numParseFloat(x[1],0);0==U&&0==F||(j.push(new JSMapPoint(U,F)),U+"/"+F+", ")}}A.push(new JSMapShape(P,R,j,I,!1,O,N))}for(var H=0,B=0,G=s.getElementsByTagName(TAG_DataSet),k=0;k<G.length;k++){var Z=G[k],J=Z.attributes,z=PUSHPINS_SHOW,V=0,X=[],Y=!1,W="poi"==(P=getXMLNodeAttribute(J,ATTR_type,"device")),K=getXMLNodeAttribute(J,ATTR_id,""),q=ROUTE_LINE_SHOW,Q=[],$="false"!=getXMLNodeAttribute(J,ATTR_route,"true"),ee=getXMLNodeAttribute(J,ATTR_textColor,""),te=getXMLNodeAttribute(J,ATTR_routeColor,"");""==te&&(te=ROUTE_LINE_COLOR),q&&(W||$||(q=!1));var ae=Z.getElementsByTagName(TAG_Point),ne=0;ae.length-ne>MAX_PUSH_PINS&&(ne=ae.length-MAX_PUSH_PINS,Y=!0);for(var ie=0,se=null,oe=null,re=null,le=ne;le<ae.length;le++){var pe=ae[le].childNodes[0].nodeValue,he=new MapEventRecord(pe);if(he.valid)if(he.type=P,he.typeID=K,W){he.validGPS&&(de=jsmCreatePushPin(-1,-1,N=f.length,he))&&f.push(de)}else{var de;if(null!=oe&&((oe.nextEv=he).lastEv=oe),0<(oe=he).timestamp?(H++,he.index=H,ie++):he.index=0,he.validGPS){if(q&&Q.push(new JSMapPoint(he.latitude,he.longitude)),0<he.timestamp)SHOW_ADDR||null==he.address||(SHOW_ADDR=!0),(de=jsmCreatePushPin(H,S,N=V,he))&&(((se=de).show=z)&&(se.show=!0,X.push(se)),M.push(new JSDetailPoint(H,S,N,he,ee)),V++)}else 0<he.timestamp&&M.push(new JSDetailPoint(H,-1,-1,he,ee));if(he.stopped<0);else if(0==he.stopped){if(null!=re){var ue=he.timestamp-re.timestamp;re.stopSec=ue}re=null}else 2==he.stopped?re=he:he.stopped;!IS_FLEET&&he.timestamp>jsvLastEventEpoch&&(jsvLastEventEpoch=he.timestamp,jsvLastEventYMD={YYYY:he.year,MM:he.month1,DD:he.day},jsvLastEventDateFmt=he.dateFmt,jsvLastEventTimeFmt=he.timeFmt,jsvLastEventTmzFmt=he.timeZone)}}if(!W){if(null!=re&&0<jsvTodayEpoch){ue=jsvTodayEpoch-re.timestamp;re.stopSec=ue}z||null==se||(se.show=!0,X.push(se)),B<ie&&(B=ie),T.push(new JSMapDataSet(X,q?Q:null,te,Y)),S++}}if(jsvUseDeviceBreaks=1<T.length&&1<B,jsvDetailPoints=M,_jsmSetMap(t,T,f,a),A&&0<A.length)for(w=0;w<A.length;w++){var ce=A[w];jsmDrawShape(ce.type,ce.radius,ce.points,ce.color,ce.zoomTo,ce.desc,ce.ppNdx)}jsvLastEventDateFmt&&jsvLastEventTimeFmt?(jsmSetIDInnerHTML(ID_LATEST_EVENT_DATE,jsvLastEventDateFmt),jsmSetIDInnerHTML(ID_LATEST_EVENT_TIME,jsvLastEventTimeFmt)):(jsmSetIDInnerHTML(ID_LATEST_EVENT_DATE,""),jsmSetIDInnerHTML(ID_LATEST_EVENT_TIME,TEXT_UNAVAILABLE)),jsmSetIDInnerHTML(ID_LATEST_EVENT_TMZ,jsvLastEventTmzFmt),jsmSetIDInnerHTML(ID_LATEST_BATTERY,jsmBatteryLevelIMG(jsvLastBatteryLevel)),jsvPartialData=Y,jsmSetIDInnerHTML(ID_MESSAGE_TEXT,jsvPartialData?TEXT_MAXPUSHPINS_MSG:""),jsmShowDetailReport();for(var _e=s.getElementsByTagName(TAG_Action),me=0;me<_e.length;me++){var ge=_e[me],Le=getXMLNodeAttribute(ge.attributes,ATTR_command,""),Ee=ge.childNodes[0].nodeValue;if("autoupdate"==Le)try{"true"==Ee?startAutoUpdateMapTimer():stopAutoUpdateMapTimer()}catch(e){}else if("alert"==Le)alert(Ee);else if("gotourl"==Le)target="_self",openURL(Ee,target);else if("showpp"==Le){jsmShowDetailPushpin(0,Ee-1)}else if("zoompp"==Le){var fe=jsmGetPushpin(0,Ee-1);if(null!=fe){jsmSetCenter(U=fe.lat,F=fe.lon,-1)}}}return jsvDetailPoints.length}function jsmLoadPoints(e,t,a){try{jsmSetLoadingPointsState(1),$.ajax({async:!1,cache:!1,dataType:"html",xhrFields:{withCredentials:!0},url:e}).done(function(e){e.trim().toUpperCase()==DATA_RESPONSE_LOGOUT?alert(TEXT_TIMEOUT):jsmParseAJAXPoints(e,t,a),jsmSetLoadingPointsState(0)})}catch(e){alert("Error [jsmLoadPoints]:\n"+e)}}JSBounds.prototype.extend=function(e){null!=e&&(this.extendLat(e.lat),this.extendLon(e.lon))},JSBounds.prototype.extendLat=function(e){e>this.maxLat&&(this.maxLat=e),e<this.minLat&&(this.minLat=e)},JSBounds.prototype.extendLon=function(e){e>this.maxLon&&(this.maxLon=e),e<this.minLon&&(this.minLon=e)},JSBounds.prototype.getSouthWest=function(){return new JSMapPoint(this.minLat,this.minLon)},JSBounds.prototype.getNorthEast=function(){return new JSMapPoint(this.maxLat,this.maxLon)},JSBounds.prototype.getCenter=function(){return new JSMapPoint((this.minLat+this.maxLat)/2,(this.minLon+this.maxLon)/2)},JSBounds.prototype.getWidth=function(){return this.maxLon-this.minLon},JSBounds.prototype.getWidthMeters=function(){var e=this.minLat;return geoDistanceMeters(e,this.minLon,e,this.maxLon)},JSBounds.prototype.getHeight=function(){return this.maxLat-this.minLat},JSBounds.prototype.getHeightMeters=function(){var e=this.minLon;return geoDistanceMeters(this.minLat,e,this.maxLat,e)},JSBounds.prototype.calculateMetersPerPixel=function(e,t){var a=this.getWidthMeters()/e,n=this.getHeightMeters()/t;return n<a?a:n},JSMapPushpin.prototype.getHTML=function(){if(null!=this.html)return this.html;if(null==this.evRcd)return alert("No Event ..."),this.html="",this.html;var e=this.evRcd,t=this.rcdNdx,a=e.device,n=e.dateFmt+" "+e.timeFmt,i=e.timeZone,s=e.accuracy,o=jsmFormatCoord(this.lat,!0,5),r=jsmFormatCoord(this.lon,!1,5),l=numFormatFloat(e.speedKPH*SPEED_KPH_MULT,1)+" "+SPEED_UNITS,p=e.address,h=(e.iconNdx,e.code),d=e.satCount,u=e.stopSec,c="";0<d&&(c+=TEXT_INFO_SATS+" "+d),0<s&&(""!=c&&(c+=", "),c+="+/- "+numFormatFloat(s*ALTITUDE_METERS_MULT,0)+" "+ALTITUDE_UNITS),""!=c&&(c="["+c+"]");var _="";if(_+="<table class='infoBoxTable' cellspacing='1' cellpadding='1' border='0'>",_+="<tr class='infoBoxRow'><td class='infoBoxCell'>[#"+t+"] &nbsp; <b>"+a+" : "+h+"</b></td></tr>",_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>"+TEXT_INFO_DATE+":</b> "+n+" ["+i+"]</td></tr>",_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>"+TEXT_INFO_GPS+":</b> "+o+" / "+r+" "+c+"</td></tr>",SHOW_SPEED)if(COMBINE_SPEED_HEAD)0<e.speedKPH?_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>"+TEXT_INFO_SPEED+":</b> "+l+" &nbsp;("+e.compass+")</td></tr>":_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>"+TEXT_INFO_SPEED+":</b> "+l+"</td></tr>";else if(_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>"+TEXT_INFO_SPEED+":</b> "+l+"</td></tr>",0<e.speedKPH){var m=numFormatFloat(e.heading,0)+"&deg; &nbsp;("+e.compass+")";_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>"+TEXT_INFO_HEADING+":</b> "+m+"</td></tr>"}if(0<u){var g="",L=u,E=(L=Math.floor(L/60))%60;if(g=E+"m "+g,E<=9&&(g="0"+g),0<(L=Math.floor(L/60))){var f=L%24;if(g=f+"h "+g,f<=9&&(g="0"+g),0<(L=Math.floor(L/24)))g=L+"d "+g}_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>"+TEXT_INFO_STOP_TIME+":</b> "+g+"</td></tr>"}if(SHOW_ALTITUDE){var S=numFormatFloat(e.altitude*ALTITUDE_METERS_MULT,0)+" "+ALTITUDE_UNITS;_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>"+TEXT_INFO_ALTITUDE+":</b> "+S+"</td></tr>"}if((""!=p||INCL_BLANK_ADDR)&&(""==p&&(p="&nbsp;"),_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>"+TEXT_INFO_ADDR+":</b> "+p+"</td></tr>"),e.batteryLevel&&""!=e.batteryLevel&&(_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>Battery Level:</b> "+e.batteryLevel+"</td></tr>"),e.ignition&&""!=e.ignition&&"-"!=e.ignition&&(_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>Ignition:</b> "+getOnOff(e.ignition)+"</td></tr>"),e.acOnOff&&""!=e.acOnOff&&"-"!=e.acOnOff&&(_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>AC:</b> "+getOnOff(e.acOnOff)+"</td></tr>"),e.doorOnOff&&""!=e.doorOnOff&&"-"!=e.doorOnOff&&(_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>AC:</b> "+getOnOff(e.doorOnOff)+"</td></tr>"),e.fuel&&""!=e.fuel&&(_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>Fuel:</b> "+e.fuel+"</td></tr>"),e.temperature&&""!=e.temperature&&(_+="<tr class='infoBoxRow'><td class='infoBoxCell'><b>Temperature:</b> "+e.temperature+"</td></tr>"),SHOW_OPT_FIELDS&&e.optDesc&&0<e.optDesc.length)for(var T=0;T<e.optDesc.length;T++){var M=e.optDesc[T];if(INCL_BLANK_OPT_FIELDS||""!=M){var A=OptionalEventFieldTitle(T);_+="<tr class='infoBoxRow'><td class='infoBoxCell'>"+(A&&""!=A?"<b>"+A+":</b> "+M:M)+"</td></tr>"}}return _+="</table>",_+="<script type='text/javascript'> jsmHighlightDetailRow("+t+",true); <\/script>\n",this.html=_,this.html};var jsmapLoadingView=null;function jsmSetLoadingPointsState(e){var t=ID_MAP_UPDATE_BTN?document.getElementById(ID_MAP_UPDATE_BTN):null;if(null!=t)switch(e){case 0:t.style.color="#000000";break;case 1:t.style.color="#338833";break;default:t.style.color="#FF0000"}if(TEXT_LOADING_MAP_POINTS)if(1==e){if(null==jsmapLoadingView){var a=getElementPosition(jsmapElem),n=getElementSize(jsmapElem),i=a.left+n.width/2-70,s=a.top+n.height/2-40;jsmapLoadingView=createDivBox("mapLoadingView",i,s,-1,-1);var o="";o+="<table class='jsmapLoadingView' cellspacing='0' cellpadding='0' border='0'>\n",o+="<tbody>\n",o+="<tr class='jsmapLoadingRow'>",MAP_LOADING_IMAGE_URI&&(o+="<td nowrap class='jsmapLoadingImage' valign='center'>",o+='<img src="'+MAP_LOADING_IMAGE_URI+'">',o+="</td>"),o+="<td nowrap class='jsmapLoadingText' valign='center'>",o+=TEXT_LOADING_MAP_POINTS,o+="</td>",o+="</tr>\n",o+="</tbody>\n",o+="</table>\n",jsmapLoadingView.innerHTML=o}document.body.appendChild(jsmapLoadingView)}else null!=jsmapLoadingView&&document.body.removeChild(jsmapLoadingView)}function jsmIsDeviceOnline(e){return(new Date).getTime()/1e3-jsvLastEventEpoch<=e}function jsmDevicePing(e){try{var t=jsmGetXMLHttpRequest();t?(t.open("GET",e,!0),t.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"),t.onreadystatechange=function(){if(4==t.readyState){var e=t.responseText;e.trim().toUpperCase()==DATA_RESPONSE_LOGOUT?alert(TEXT_TIMEOUT):e.trim().toUpperCase()==DATA_RESPONSE_PING_OK?alert(TEXT_PING_OK):alert(TEXT_PING_ERROR)}else t.readyState},t.send(null)):alert("Error [jsmDevicePing]:\n"+e)}catch(e){alert("Error [jsmDevicePing]:\n"+e)}}function jsmDrawShape(e,t,a,n,i,s,o){try{return!!jsmap&&jsmap.JSDrawShape(e,t,a,n,i,s,o)}catch(e){return!1}}function jsmParseGeozones(e){if(jsmap){if(null==e)return 0;var t=0,a=zoneMapGetIndex();if(0<=a&&a<e.length)geoIsValid(e[n=a].lat,e[n].lon)&&t++;else for(var n=0;n<e.length;n++)geoIsValid(e[n].lat,e[n].lon)&&t++;return jsmap.JSDrawGeozone(jsvZoneType,jsvZoneRadiusMeters,e,jsvZoneColor,a),t}}function jsmFormatCoord(e,t,a){if(1==LATLON_FORMAT||"DMS"==LATLON_FORMAT){var n=0<=e;e=60*((e=Math.abs(e))-(s=parseInt(e))),(o=parseInt(e))<=9&&(o="0"+o),e=60*(e-o);var i=parseInt(e);return i<=9&&(i="0"+i),s+"&deg;"+o+"'"+i+"&quot;"+(t?n?HEADING[0]:HEADING[4]:n?HEADING[2]:HEADING[6])}if(2==LATLON_FORMAT||"DM"==LATLON_FORMAT){var s,o;n=0<=e;return(o=numFormatFloat(e=60*((e=Math.abs(e))-(s=parseInt(e))),LATLON_FORMAT_MIN_DEC))<=9&&(o="0"+o),s+"&deg;"+o+"'"+(t?n?HEADING[0]:HEADING[4]:n?HEADING[2]:HEADING[6])}return numFormatFloat(e,a)}function jsmCreatePushPin(e,t,a,n){var i=jsmGetPushPinIcon(n.iconNdx,n);return new JSMapPushpin(e,t,a,n,n.latitude,n.longitude,n.device,null,i)}function jsmGetPushPinIcon(icon,e){var pp=0<=icon&&icon<jsvPushpinIcon.length?jsvPushpinIcon[icon]:jsvPushpinIcon[0];if(pp.iconEval)try{var url=eval(pp.iconEval);pp.iconURL=url}catch(e){console.log("iconEval Error"+e),jsvPushpinIcon[0].iconEval?pp.iconURL="":pp.iconURL=jsvPushpinIcon[0].iconURL}if(void 0!==pp.bgPP&&0<=pp.bgPP&&pp.bgPP<jsvPushpinIcon.length){var bgPP=jsvPushpinIcon[pp.bgPP];if(bgPP.iconEval)try{var url=eval(bgPP.iconEval);pp.bgURL=url,pp.bgSize=bgPP.iconSize,pp.bgOffset=bgPP.iconHotspot}catch(e){console.log("background iconEval Error"+e),pp.bgURL=null}}return pp}function jsmCreateCircle(e,t){var a=geoRadians(e.lat),n=geoRadians(e.lon),i=t/EARTH_RADIUS_METERS,s=new Array;for(x=0;x<=360;x+=5){var o=geoRadians(x),r=Math.asin(Math.sin(a)*Math.cos(i)+Math.cos(a)*Math.sin(i)*Math.cos(o)),l=n+Math.atan2(Math.sin(o)*Math.sin(i)*Math.cos(a),Math.cos(i)-Math.sin(a)*Math.sin(r));s.push(new JSMapPoint(geoDegrees(r),geoDegrees(l)))}return s}function jsmCalcRadiusPoint(e,t,a,n){var i=geoRadians(e),s=geoRadians(t),o=a/EARTH_RADIUS_METERS,r=geoRadians(n),l=Math.asin(Math.sin(i)*Math.cos(o)+Math.cos(i)*Math.sin(o)*Math.cos(r)),p=s+Math.atan2(Math.sin(r)*Math.sin(o)*Math.cos(i),Math.cos(o)-Math.sin(i)*Math.sin(l));return new JSMapPoint(geoDegrees(l),geoDegrees(p))}function jsmGetPushpin(e,t){if(jsmap){if(e<0||t<0)return null;if(null==jsvDataSets||jsvDataSets.length<=0)return null;if(e>=jsvDataSets.length)return null;var a=jsvDataSets[e].pushPins;return a&&t<a.length?a[t]:null}}function jsmShowDetailPushpin(e,t){if(jsmap&&!(!DETAIL_INFO_BOX||e<0||t<0||null==jsvDataSets||jsvDataSets.length<=0||e>=jsvDataSets.length)){var a=jsvDataSets[e].pushPins;a&&t<a.length&&jsmap.JSShowPushpin(a[t],jsvDetailCenterPushpin)}}function jsmShowDetailReport(){var e=document.getElementById(ID_DETAIL_TABLE),t=jsvDetailPoints,a=e.innerHTML="",n=(SORTABLE_LOCATION_DETAILS,SORTABLE_LOCATION_DETAILS?CLASS_DETAILS_HEADER_COL_S:CLASS_DETAILS_HEADER_COL_N);if(a+="<table id='LocationDetailsReport' class='fixed_headers' cellspacing='0' cellpadding='0'>\n",a+="<thead class='fix_table_header_bg_color'>\n",jsvPartialData){var i=4+(IS_FLEET?1:0)+(SHOW_ADDR?1:0)+(SHOW_SPEED?COMBINE_SPEED_HEAD?1:2:0);a+="<tr class='"+CLASS_DETAILS_HEADER_ROW+"'>",a+="<th class='"+n+"' colSpan='"+i+"' valign='center' style='color:red; border-bottom: 1px solid black;'>"+TEXT_MAXPUSHPINS_MSG+"</th>",a+="</tr>\n"}if(a+="<tr class='"+CLASS_DETAILS_HEADER_ROW+"'>",a+=_jsmShowDetailReport_header(25,"#",n),IS_FLEET&&(a+=_jsmShowDetailReport_header(-1,TEXT_DEVICE,n)),a+=_jsmShowDetailReport_header(-1,TEXT_DATE,n),a+=_jsmShowDetailReport_header(-1,TEXT_CODE,n),a+=_jsmShowDetailReport_header(-1,TEXT_LATLON,CLASS_DETAILS_HEADER_COL_N),SHOW_SAT_COUNT&&(a+=_jsmShowDetailReport_header(-1,TEXT_SATCOUNT,n)),SHOW_SPEED&&(COMBINE_SPEED_HEAD?a+=_jsmShowDetailReport_header(-1,TEXT_SPEED,n):(a+=_jsmShowDetailReport_header(-1,TEXT_SPEED,n),a+=_jsmShowDetailReport_header(-1,TEXT_HEADING,CLASS_DETAILS_HEADER_COL_N))),SHOW_ADDR&&(a+=_jsmShowDetailReport_header(-1,TEXT_ADDR,CLASS_DETAILS_HEADER_COL_N)),SHOW_OPT_FIELDS)for(var s=CLASS_DETAILS_HEADER_COL_N,o=0;o<OptionalEventFieldCount();o++){a+=_jsmShowDetailReport_header(-1,OptionalEventFieldTitle(o),s)}a+="</tr>\n",a+="</thead>\n",a+="<tbody>\n";for(var r="",l=0;l<t.length;l++){var p=jsvDetailAscending?t[l]:t[t.length-l-1],h=jsvUseDeviceBreaks&&r!=p.device?CLASS_DETAILS_DATA_COL_NEW:CLASS_DETAILS_DATA_COL;r=p.device;var d=1==(1&p.index);if(a+="<tr class='"+(d?CLASS_DETAILS_ROW_ODD:CLASS_DETAILS_ROW_EVEN)+"' id='"+(ID_DETAIL_ROW_+p.index)+"'",""!=p.color){var u=p.color;if(1==DISPLAY_COLOR_TYPE)a+=" style='color:"+u+";'";else if(2==DISPLAY_COLOR_TYPE){if(d){var c=rgbLighter(rgbVal(u),.35);u="#"+rgbHex(c.R,c.G,c.B)}a+=" style='background-color:"+u+";'"}}if(a+=">",DETAIL_INFO_BOX?a+="<td nowrap class='"+CLASS_DETAILS_INDEX_COL+"' onclick=\"javascript:window.jsmShowDetailPushpin("+p.dsNdx+","+p.ppNdx+')">'+p.index+"</td>":a+="<td nowrap class='"+h+"'>"+p.index+"</td>",IS_FLEET&&(a+="<td nowrap class='"+h+"'>"+p.device+"</td>"),a+="<td nowrap class='"+h+"' sorttable_customkey='"+p.timestamp+"'>"+p.dateTime+"</td>",a+="<td nowrap class='"+h+"'>"+p.code+"</td>",a+="<td nowrap class='"+h+"'>"+p.latlon+"</td>",SHOW_SAT_COUNT&&(a+="<td nowrap class='"+h+"'>"+p.satCount+"</td>"),SHOW_SPEED)if(COMBINE_SPEED_HEAD)a+="<td nowrap class='"+h+"'>"+(0<p.speed?p.speed+" "+p.compass:p.speed)+"</td>";else a+="<td nowrap class='"+h+"'>"+p.speed+"</td>",a+="<td nowrap class='"+h+"'>"+p.heading+"&deg; "+p.compass+"</td>";if(SHOW_ADDR&&(a+="<td class='"+h+"'>"+p.address+"&nbsp;</td>"),SHOW_OPT_FIELDS)for(o=0;o<OptionalEventFieldCount()&&o<10;o++){a+="<td nowrap class='"+h+"'>"+(p.optDesc&&o<p.optDesc.length?p.optDesc[o]:"")+"&nbsp;</td>"}a+="</tr>\n"}a+="</tbody>\n";var _="";_+="<div class='"+CLASS_DETAILS_DIV+"'>"+(a+="</table>\n")+"</div>",e.innerHTML=_}function _jsmShowDetailReport_header(e,t,a){var n="<th class='"+a+"' nowrap valign='center'";return 0<e&&(n+=" width='"+e+"'"),n+=">"+t+"</th>"}function _jsmHighlightDetailRow(e,t){var a=DETAILS_WINDOW?jsvDetailsWindow:window;if(null!=a&&1<=e){var n=a.document.getElementById(ID_DETAIL_ROW_+e);if(null!=n)if(t)n.className=CLASS_DETAILS_ROW_HILITE;else{var i=1==(1&e);n.className=i?CLASS_DETAILS_ROW_ODD:CLASS_DETAILS_ROW_EVEN}}}function jsmHighlightDetailRow(e,t){null!=jsvDetailsLastHilightedRow&&(_jsmHighlightDetailRow(jsvDetailsLastHilightedRow.row,!1),jsvDetailsLastHilightedRow=null);var a=parseInt(e);1<=a&&t&&(_jsmHighlightDetailRow(a,!0),t&&(jsvDetailsLastHilightedRow={row:a}))}function jsmSetReplayState(e){try{var t=ID_MAP_REPLAY_BTN?document.getElementById(ID_MAP_REPLAY_BTN):null;t&&(t.innerHTML=e==REPLAY_RUNNING?"<i id='mapReplayButton' name='replayMap' class='material-icons'>pause</i>":"<i id='mapReplayButton' name='replayMap' class='material-icons'>play_arrow</i>")}catch(e){}}function jsmGetDistanceDisplayElement(){return document.getElementById(ID_DISTANCE_DISPLAY)}function jsmSetDistanceDisplay(e){var t=jsmGetDistanceDisplayElement();if(null!=t)if(jsvGeozoneMode){var a=numFormatFloat(e,0)+" "+TEXT_METERS;t.innerHTML=a}else{a=numFormatFloat(DISTANCE_KM_MULT*e/1e3,2)+" "+TEXT_DISTANCE;t.innerHTML=a}}function jsmGetLatLonDisplayElement(){return document.getElementById(ID_LAT_LON_DISPLAY)}function jsmSetLatLonDisplay(e,t){var a=jsmGetLatLonDisplayElement();if(null!=a){if(0==e&&0==t){var n=jsmFormatCoord(0,!0,4)+", "+jsmFormatCoord(0,!1,4);a.innerHTML=n}else{n=jsmFormatCoord(e,!0,4)+", "+jsmFormatCoord(t,!1,4);a.innerHTML=n}}}function jsmSetPointZoneValue(e,t,a){_jsmSetPointZoneValue(zoneMapGetIndex(),e,t,a)}function _jsmSetPointZoneValue(e,t,a,n){0<=e&&e<jsvZoneList.length&&(jsvZoneList[e].lat=t,jsvZoneList[e].lon=a,jsmSetIDValue(ID_ZONE_LATITUDE_+e,numFormatFloat(t,5)),jsmSetIDValue(ID_ZONE_LONGITUDE_+e,numFormatFloat(a,5)),0<=n&&jsmSetIDValue(ID_ZONE_RADIUS_M,n),jsmSetLatLonDisplay(t,a),jsmSetDistanceDisplay(n))}function jsmGetElementValue(e){return null!=e?e.value:null}function jsmSetElementValue(e,t){null!=e&&(e.value=t)}function jsmGetIDValue(e){return jsmGetElementValue(document.getElementById(e))}function jsmSetIDValue(e,t){jsmSetElementValue(document.getElementById(e),t)}function jsmSetElementInnerHTML(e,t){null!=e&&(e.innerHTML=t)}function jsmSetIDInnerHTML(e,t){jsmSetElementInnerHTML(document.getElementById(e),t)}function jsmCustomMapMarker(e,t,a){return"http://chart.apis.google.com/chart?cht=mm&ext=.png&chs="+e+"x"+t+"&chco="+a+"FF,"+a+"FF,000000FF"}var mapControlVisible=!0;function jsmControlToggleCollapse(){var e=ID_MAP_CONTROL?document.getElementById(ID_MAP_CONTROL):null,t=ID_MAP_CONTROL_BAR?document.getElementById(ID_MAP_CONTROL_BAR):null;null!=e&&CLASS_CONTROL_BAR&&(mapControlVisible?(e.style.display="none",t&&(t.className=CLASS_CONTROL_BAR[1]),mapControlVisible=!1):(e.style.display="",t&&(t.className=CLASS_CONTROL_BAR[0]),mapControlVisible=!0))}function jsmControlDisplay(e){var t=ID_MAP_CONTROL?document.getElementById(ID_MAP_CONTROL):null,a=ID_MAP_CONTROL_BAR?document.getElementById(ID_MAP_CONTROL_BAR):null;null!=t&&CLASS_CONTROL_BAR&&(e?mapControlVisible||(t.style.display="",a&&(a.className=CLASS_CONTROL_BAR[0]),mapControlVisible=!0):mapControlVisible&&(t.style.display="none",a&&(a.className=CLASS_CONTROL_BAR[1]),mapControlVisible=!1))}function evSpeedColor(e){var t,a=e.speedMPH,n=[0,210,0],i=[240,240,0],s=[255,0,0];return 70<a?rgbHex(n[0],n[1],n[2]):20<=a?rgbHex((n[0]-i[0])*(t=(a-20)/50)+i[0],(n[1]-i[1])*t+i[1],(n[2]-i[2])*t+i[2]):0<=a?rgbHex((i[0]-s[0])*(t=(a-0)/20)+s[0],(i[1]-s[1])*t+s[1],(i[2]-s[2])*t+s[2]):"000000"}function evSpeedMarkerURL(e,t,a){return jsmCustomMapMarker(e,t,evSpeedColor(a))}function evCurrentAgeMarkerURL(e){var t=(new Date).getTime()/1e3,a=t>e.timestamp?t-e.timestamp:0;return a<=900?"images/pp/pin30_green.png":a<=3600?"images/pp/pin30_yellow.png":a<=21600?"images/pp/pin30_red.png":"images/pp/pin30_red_dot.png"}function evCreateAgeMarkerURL(e){var t=e.createAge;return t<=900?"images/pp/pin30_green.png":t<=3600?"images/pp/pin30_yellow.png":t<=21600?"images/pp/pin30_red.png":"images/pp/pin30_red_dot.png"}function evGpsAgeMarkerURL(e){var t=e.gpsAge;return t<=900?"images/pp/pin30_green.png":t<=3600?"images/pp/pin30_yellow.png":t<=21600?"images/pp/pin30_red.png":"images/pp/pin30_red_dot.png"}function evHeadingMarkerURL(e){return 0<MAX_CREATION_AGE_SEC&&e.createAge>MAX_CREATION_AGE_SEC?0<e.stopped||e.speedKPH<5?"images/pp/pin30_black.png":"images/pp/pin30_black_h"+Math.round(e.heading/45)%8+".png":0<e.stopped?2==e.stopped?"images/pp/pin30_red_dot.png":"images/pp/pin30_red.png":e.speedKPH<5?"images/pp/pin30_red_dot.png":e.speedKPH<32?"images/pp/pin30_yellow_h"+Math.round(e.heading/45)%8+".png":"images/pp/pin30_green_h"+Math.round(e.heading/45)%8+".png"}function evHeadingMarkerURL_eu(e){var t=.621371192*e.speedKPH;return 0<e.stopped?2==e.stopped?"images/pp/pin30_red_dot.png":"images/pp/pin30_red.png":t<5?"images/pp/pin30_red_dot.png":t<50?"images/pp/pin30_yellow_h"+Math.round(e.heading/45)%8+".png":t<90?"images/pp/pin30_green_h"+Math.round(e.heading/45)%8+".png":t<110?"images/pp/pin30_gray.png":"images/pp/pin30_black.png"}function evHeadingMarkerURL_ca(e){return 0<e.stopped?2==e.stopped?"images/pp/pin30_red_dot.png":"images/pp/pin30_red.png":e.speedKPH<1?"images/pp/pin30_red.png":e.speedKPH<70?"images/pp/pin30_yellow_h"+Math.round(e.heading/45)%8+".png":e.speedKPH<100?"images/pp/pin30_green_h"+Math.round(e.heading/45)%8+".png":e.speedKPH<130?"images/pp/pin30_blue_h"+Math.round(e.heading/45)%8+".png":"images/pp/pin30_gray_h"+Math.round(e.heading/45)%8+".png"}function evHeadingMarkerURL_CC(e){return 0<e.stopped?2==e.stopped?"images/pp/pin30_red_dot.png":"images/pp/pin30_red.png":e.speedKPH<10?"images/pp/pin30_red.png":e.speedKPH<60?"images/pp/pin30_yellow_h"+Math.round(e.heading/45)%8+".png":e.speedKPH<90?"images/pp/pin30_green_h"+Math.round(e.heading/45)%8+".png":e.speedKPH<110?"images/pp/pin30_blue_h"+Math.round(e.heading/45)%8+".png":"images/pp/pin30_black_h"+Math.round(e.heading/45)%8+".png"}function evHeadingYellowURL(e){return 0<MAX_CREATION_AGE_SEC&&e.createAge>MAX_CREATION_AGE_SEC?e.speedKPH<1?"images/pp/pin30_black.png":"images/pp/pin30_black_h"+Math.round(e.heading/45)%8+".png":e.speedKPH<1?"images/pp/pin30_yellow.png":"images/pp/pin30_yellow_h"+Math.round(e.heading/45)%8+".png"}function evHeadingGreenURL(e){return 0<MAX_CREATION_AGE_SEC&&e.createAge>MAX_CREATION_AGE_SEC?e.speedKPH<1?"images/pp/pin30_black.png":"images/pp/pin30_black_h"+Math.round(e.heading/45)%8+".png":e.speedKPH<1?"images/pp/pin30_green_dot.png":"images/pp/pin30_green_h"+Math.round(e.heading/45)%8+".png"}function evHeadingURL(e,t){return e.speedKPH<1?"images/pp/pin30_"+t+".png":"images/pp/pin30_"+t+"_h"+Math.round(e.heading/45)%8+".png"}function evSpeedLastURL(e){return e.speedKPH<1?"extra/images/pp/CrosshairRed.gif":e.speedKPH<40?"extra/images/pp/CrosshairYellow.gif":"extra/images/pp/CrosshairGreen.gif"}function evIndexedIconURL(e){return evTextLabelIconURL("/images/pp/pin30_blue_fill.png","3,4,11,7,9,Serif","","","880000",e.index)}function evDeviceNameIconURL(e,t,a){return evTextLabelIconURL("#White_47x1","",t||"",a||"","",e.devVIN)}function evDeviceNameIconURL_W(e,t,a){return evTextLabelIconURL("#White_67x1","",t||"",a||"","",e.devVIN)}function evDeviceNameIconURL_PPL2(e,t,a){var n="";return n+=e.devVIN+"\n",evTextLabelIconURL("#White_67x2_pp","",t||"#EEF5F5F5",a||"","",n+=numFormatFloat(e.speedKPH*SPEED_KPH_MULT,0)+" "+SPEED_UNITS)}function evDeviceNameIconURL_PPL3(e,t,a){var n="";return n+=e.devVIN+"\n",n+=e.timeFmt+"\n",evTextLabelIconURL("#White_67x3_pp","",t||"#EEF5F5F5",a||"","",n+=numFormatFloat(e.speedKPH*SPEED_KPH_MULT,0)+" "+SPEED_UNITS)}function evDeviceNameSpeedIconURL(e){return evTextLabelIconURL("#White_47x1","",e.speedKPH<5?"FF8888":e.speedKPH<32?"FFFF88":"88FF88","","",e.devVIN)}function evOptFieldIconURL(e,t){return evTextLabelIconURL("#White_47x1","","","yellow","",SHOW_OPT_FIELDS&&e.optDesc&&0<=t&&t<e.optDesc.length?e.optDesc[t]:"")}function evLabelIconURL(e,t,a,n){return evTextLabelIconURL(t,a,n,"","",e.devVIN)}function evTextLabelIconURL(e,t,a,n,i,s){return"Marker?icon="+strEncode(e)+"&fr="+strEncode(t)+"&fill="+strEncode(a)+"&border="+strEncode(n)+"&color="+strEncode(i)+"&text="+strEncode(s)}function evArrowIconURL(e,t,a,n){var i=0<e.speedKPH?e.heading:360;return evArrowLabelIconURL(t,a,"","",n||(e.speedKPH<5?"DD0000":e.speedKPH<32?"FFD700":"00CC00"),i)}function evArrowLabelIconURL(e,t,a,n,i,s){return"Marker?icon="+strEncode(e)+"&fr="+strEncode(t)+"&fill="+strEncode(a)+"&border="+strEncode(n)+"&color="+strEncode(i)+"&arrow="+strEncode(s)}function evDeviceNameBubbleURL(e,t,a){return"http://chart.googleapis.com/chart?chst=d_bubble_text_small&chld=bb|"+e.devVIN+"|"+t+"|"+a}function jsmBatteryLevelIMG(e){1.5<e&&(e/=100);var t=1;try{t=BATTERY_LEVEL_TYPE}catch(e){t=1}var a="";if(2==t)if(e<=.01)a="images/Batt000.png";else{var n=numParseInt(100*e+.5,0);99<n&&(n=99),a="Marker?icon=/images/Batt000.png&fr=5,2,25,12,10&text="+n+"%25"}else a=e<=.01?"images/Batt000.png":e<=.25?"images/Batt025.png":e<=.5?"images/Batt050.png":e<=.7?"images/Batt070.png":e<=.9?"images/Batt090.png":"images/Batt100.png";return'<img src="'+a+'"/>'}var recursiveRefresh=0;function mapDevicePing(e){jsmDevicePing(e)}function mapProviderParseZones(e){jsMapInit(),jsmParseGeozones(e)}function mapProviderParseXML(e){jsMapInit(),jsmParseAJAXPoints(e,jsmRecenterZoomMode(RECENTER_ZOOM),0)}function mapProviderUpdateMap(e,t,a){0==recursiveRefresh&&(recursiveRefresh++,jsMapInit(),jsmLoadPoints(e,t,a),recursiveRefresh--)}function mapProviderPauseReplay(e){return jsmap?jsmap.JSPauseReplay(e):REPLAY_STOPPED}function mapProviderToggleDetails(){jsvDetailVisible=!!DETAILS_WINDOW||!jsvDetailVisible,jsmShowDetailReport()}function mapProviderUnload(){jsmUnload()}function evHeadingOrangeURL(e){return e.speedKPH<1?"images/pp/pin30_orance_dot.png":"images/pp/pin30_orange_h"+Math.round(e.heading/45)%8+".png"}function evHeadingBlueURL(e){return e.speedKPH<1?"images/pp/pin30_blue_dot.png":"images/pp/pin30_blue_h"+Math.round(e.heading/45)%8+".png"}function evColorTrack(e,t){return e.speedKPH<1?"images/pp/pin30_red_dot.png":"images/pp/pin30_"+t+"_h"+Math.round(e.heading/45)%8+".png"}function evVehicleRotate(e,t,a){var n=360/a;return"images/pp/vehicle/"+t+"_h"+Math.round(e.heading/a)%n+".png"}function jsmPushPinGeoZoneShowForm(){document.getElementById("jsmap_gz2").style.visibility="visible",document.getElementById("jsmap_gz1").style.visibility="hidden"}function jsmPushPinGeoZoneSubmitForm(){var e=document.getElementById("jsmap_form_gz"),t=e.z_newid.value,a=e.z_newname.value,n="N";e.z_ispoi.checked&&(n="Y");var i=e.z_lat0.value,s=e.z_lon0.value;if(0==t.trim().length)return alert("GeoZone Id should be entered"),void e.z_newid.focus();if(0==a.trim().length)return alert("GeoZone Name should be entered"),void e.z_newname.focus();var o=MAP_IMAGE_URL+"/Track?page=zone.info&page_cmd=pushpincrt"+"&_uniq="+Math.random()+"&z_newid="+strEncode(t)+"&z_ispoi="+strEncode(n)+"&z_radius= 100&z_lat0="+strEncode(i)+"&z_lon0="+strEncode(s)+"&z_desc="+strEncode(a);try{var r=jsmGetXMLHttpRequest();r?(r.open("GET",o,!0),r.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"),r.onreadystatechange=function(){if(4==r.readyState){var e=r.responseText;e.trim().toUpperCase()==DATA_RESPONSE_LOGOUT?(alert(TEXT_TIMEOUT),document.getElementById("jsmap_gz1").innerHTML="<b>"+TEXT_TIMEOUT+"</b>"):document.getElementById("jsmap_gz1").innerHTML="<b>"+e.trim()+"</b>"}else r.readyState},document.getElementById("jsmap_gz1").innerHTML="<b>Creating GeoZone....</b>",document.getElementById("jsmap_gz2").style.visibility="hidden",document.getElementById("jsmap_gz1").style.visibility="visible",r.send(null)):alert("Error [jsmGeoZoneCreate]:\n"+mapURL)}catch(e){alert("Error [jsmGeoZoneCreate]:\n"+e)}}var calImageBaseDir=".",CLASS_CAL_DIV="calDiv",CLASS_CAL_TABLE="calTable",CLASS_CAL_EXPAND_BAR="calExpandBar",CLASS_CAL_COLLAPSE_BAR="calCollapseBar",CLASS_CAL_TITLE_DATE_CELL="calTitleDateCell",CLASS_CAL_TITLE_TABLE="calTitleTable",CLASS_CAL_TITLE_FIELD_EXP="calTitleFieldExpanded",CLASS_CAL_DATE_TIME_EXP="calDateTimeFieldExpanded",CLASS_CAL_DATE_FIELD="calDateField",CLASS_CAL_TIME_EXP="calTimeFieldExpanded",CLASS_CAL_TIME_EXP_COLON="calTimeFieldExpandedColon",CLASS_CAL_TITLE_FIELD_COLL="calTitleFieldCollapsed",CLASS_CAL_DATE_TIME_COLL="calDateTimeFieldCollapsed",CLASS_CAL_TIME_COLL="calTimeFieldCollapsed",CLASS_CAL_TIME_DISABLED="calTimeFieldDisabled",CLASS_CAL_MONTH_ADVANCE="calMonthAdvance",CLASS_CAL_MONTH_ADV_CLICK="calMonthAdvanceClick",CLASS_CAL_MONTH_HEADER_TBL="calMonthHeaderTable",CLASS_CAL_MONTH_NAME="calMonthName",CLASS_CAL_MONTH_DAYS_CELL="calMonthDaysCell",CLASS_CAL_MONTH_DAYS_TBL="calMonthDaysTable",CLASS_CAL_MONTH_DOW="calMonthDOW",CLASS_CAL_PREV_MONTH_DAYS="calPrevMonthDays",CLASS_CAL_NEXT_MONTH_DAYS="calNextMonthDays",CLASS_CAL_MONTH_DAYS_ENABLE="calThisMonthDaysEnabled",CLASS_CAL_MONTH_DAYS_DISABL="calThisMonthDaysDisabled",CLASS_CAL_SELECTED_DAY="calSelectedDay",DIVBOX_OVERRIDE_ONMOUSEDOWN=!1;function calShowCalendar(e){e&&e.writeCalendar()}function calSelectTimeZone(e){calSelectedTMZ=e}function calGetTimeZone(){return calSelectedTMZ}function calResetDimensions(e,t){if(null!=e&&null!=t){var a=Math.max(e.getWidth(),t.getWidth());e.setMinimumWidth(a),t.setMinimumWidth(a);var n=document.getElementById(ID_CAL_DIV),i=document.getElementById(ID_CAL_BOTTOM);if(n&&i){var s=getElementPosition(n),o=getElementPosition(i),r=Math.abs(o.top-s.top)+3;n.style.height=r}}}function calWriteCalendars(e,t){if(e==t&&(t=null),null!=e&&null!=t){e.setNextCalendar(t),t.setPriorCalendar(e);var a=!e.drawDivBox,n=!1;e.setExpanded(a,n),t.setExpanded(!1,n),calResetDimensions(e,t)}else if(null!=e){var i=!e.drawDivBox;n=!1;e.setExpanded(i,n)}else if(null!=t){i=!t.drawDivBox,n=!1;t.setExpanded(i,n)}}var CalMonthDays=[31,28,31,30,31,30,31,31,30,31,30,31],CAL_ID_TABLE=".table",CAL_ID_DATE=".ymd",CAL_ID_DAY=".day",CAL_ID_TIME=".time",CAL_ID_TIME_HH=".timeHH",CAL_ID_TIME_MM=".timeMM",COLOR_THISDAY_BG="#EFFFFF",COLOR_THISDAY_BGS="#00EEEE",COLOR_THISDAY_FG=null,COLOR_THISDAY_FGS=null,ARROW_DOWN_CHAR="&#9660;",ARROW_UP_CHAR="&#9650;",FADE_INTERVAL_MS=1;function Calendar(e,t,a,n,i,s,o,r){this.calVarName=e,this.calID=e,this.calFormID=t,this.title=a,this.enabled=!0,this.year=parseInt(n),this.month1=parseInt(i),this.month1<1&&(this.month1=1),12<this.month1&&(this.month1=12),this.selDay=parseInt(s),this.constrainSelectedDay(!1),this.eodHour=o,this.eodMin=r,this.selHour=this.eodHour,this.selMin=this.eodMin,this.nextCal=null,this.priorCal=null,this.enableFade=!0,this.collapsible=!1,this.expanded=!1,this.divCalView=null,this.divOnmousedown=null,this.drawDivBox=!1,this.drawClickBar=!1,this.drawFixedExpanded=!0,this.selectCallback=null,this.showYearAdv=!1,this.didInit=!1}Calendar.prototype.setEnabled=function(e){return this.enabled=e,this},Calendar.prototype.isEnabled=function(){return this.enabled},Calendar.prototype.setCallbackOnSelect=function(e){this.selectCallback=e},Calendar.prototype.setYearAdvanceSelection=function(e){this.showYearAdv=e},Calendar.prototype.setCollapsible=function(e,t,a){return this.collapsible=e,this.enableFade=t,this.drawDivBox=a,this.drawDivBox&&(this.collapsible=!1,this.enableFade=!1),this.drawClickBar=this.collapsible||this.drawDivBox,this.drawFixedExpanded=!this.collapsible&&!this.drawDivBox,this},Calendar.prototype.getWidth=function(){var e=document.getElementById(this.calID+CAL_ID_TABLE);return null!=e?getElementSize(e).width:0},Calendar.prototype.setMinimumWidth=function(e){var t=document.getElementById(this.calID);null!=t&&t.offsetWidth<e&&(t.style.width=e+"px")},Calendar.prototype.setPriorCalendar=function(e){this.priorCal=e},Calendar.prototype.isSameMonthAsPriorCalendar=function(){return null!=this.priorCal&&this.priorCal.getSelectedMonthNumber()>=this.getSelectedMonthNumber()},Calendar.prototype.setNextCalendar=function(e){this.nextCal=e},Calendar.prototype.isSameMonthAsNextCalendar=function(){return null!=this.nextCal&&this.nextCal.getSelectedMonthNumber()<=this.getSelectedMonthNumber()},Calendar.prototype.getOtherCalendar=function(){return null!=this.nextCal?this.nextCal:this.priorCal},Calendar.prototype.daysInMonth=function(e,t){var a=e%4==0,n=(t-1+12)%12,i=CalMonthDays[n];return 1==n&&a&&i++,i},Calendar.prototype.dayNumber=function(e,t,a){var n=1e3*e+parseInt(1e3*(t-3)/12);return parseInt((367*n+625)/1e3)-2*parseInt(n/1e3)+parseInt(n/4e3)-parseInt(n/1e5)+parseInt(n/4e5)+a-578042},Calendar.prototype.dayOfWeek=function(e,t,a){return(this.dayNumber(e,t,a)+5)%7},Calendar.prototype.epochSecondsToYmdHms=function(e){var t=e%86400,a=e/86400+719469,n=(1e3*a-200)/36524250,i=a+n-n/4,s=(1e3*i-200)/365250,o=i-365250*s/1e3,r=(1e3*o-500)/30600;return{YYYY:r<=9?s:s+1,MM:r<=9?r+3:r-9,DD:(1e3*o-30600*r+500)/1e3,hh:t/3600,mm:t%3600/60,ss:t%3600%60}},Calendar.prototype.getArgDate=function(){return this.year+"/"+(this.month1<=9?"0"+this.month1:this.month1)+"/"+(this.selDay<=9?"0"+this.selDay:this.selDay)},Calendar.prototype.getArgDateTime=function(){var e=this.selHour<=9?"0"+this.selHour:this.selHour,t=this.selMin<=9?"0"+this.selMin:this.selMin;return this.getArgDate()+"/"+e+":"+t},Calendar.prototype.setFormDate=function(){var YY=this.year,MM=this.month1<=9?"0"+this.month1:this.month1,DD=this.selDay<=9?"0"+this.selDay:this.selDay,hh=this.selHour<=9?"0"+this.selHour:this.selHour,mm=this.selMin<=9?"0"+this.selMin:this.selMin,dfld=document.getElementById(this.calID+CAL_ID_DATE);null!=dfld&&(dfld.innerHTML=calFormatDisplayDate(YY,MM,DD));var tfld=document.getElementById(this.calID+CAL_ID_TIME);if(null!=tfld)tfld.innerHTML=hh+":"+mm;else{var hhfld=document.getElementById(this.calID+CAL_ID_TIME_HH);null!=hhfld&&(calTextTimeEntry?hhfld.value=hh:hhfld.innerHTML=hh);var mmfld=document.getElementById(this.calID+CAL_ID_TIME_MM);null!=mmfld&&(calTextTimeEntry?mmfld.value=mm:mmfld.innerHTML=mm)}if(null!=this.calFormID){var formElem=eval("document."+this.calFormID);formElem.value=YY+"/"+MM+"/"+DD+"/"+hh+":"+mm}},Calendar.prototype.getSelectedDayNumber=function(){return this.dayNumber(this.year,this.month1,this.selDay)},Calendar.prototype.getSelectedMonthNumber=function(){return 100*this.year+this.month1},Calendar.prototype.constrainSelectedDay=function(e){if(this.selDay<1)e?(this.month1--,this.month1<1&&(this.year--,this.month1=12),this.selDay=this.daysInMonth(this.year,this.month1)):this.selDay=1;else{var t=this.daysInMonth(this.year,this.month1);this.selDay>t&&(e?(this.month1++,12<this.month1&&(this.year++,this.month1=1),this.selDay=1):this.selDay=t)}return this.selDay},Calendar.prototype._selectDay=function(e,t,a){this.selDay=parseInt(e),this.constrainSelectedDay(!1),this.selHour=void 0===t?this.eodHour:t,this.selMin=void 0===a?this.eodMin:a;for(var n=1;n<=31;n++){var i=document.getElementById(this.calID+CAL_ID_DAY+"."+n);null!=i&&(i.className=n==e?CLASS_CAL_SELECTED_DAY:this.enabled?CLASS_CAL_MONTH_DAYS_ENABLE:CLASS_CAL_MONTH_DAYS_DISABL)}this.setFormDate()},Calendar.prototype.selectDay=function(e,t,a){this._selectDay(e,t,a),null!=this.selectCallback&&this.selectCallback()},Calendar.prototype.advanceHour=function(e){this.enabled&&(10==e?14<=this.selHour?this.selHour=this.selHour%10:this.selHour+=10:-10==e?this.selHour<=3?this.selHour+=20:this.selHour<=9?this.selHour+=10:this.selHour-=10:this.selHour=(this.selHour+e+24)%24,this.setFormDate())},Calendar.prototype.advanceMinute=function(e){this.enabled&&(this.selMin=(this.selMin+e+60)%60,this.setFormDate())},Calendar.prototype.setInputHour=function(){if(this.enabled){var e=document.getElementById(this.calID+CAL_ID_TIME_HH);if(null!=e){var t=e.value;this.selHour=numParseInt(t,this.eodHour),this.selHour=(this.selHour+24)%24}this.setFormDate()}},Calendar.prototype.setInputMinute=function(){if(this.enabled){var e=document.getElementById(this.calID+CAL_ID_TIME_MM);if(null!=e){var t=e.value;this.selMin=numParseInt(t,this.eodMin),this.selMin=(this.selMin+60)%60}this.setFormDate()}},Calendar.prototype.isExpanded=function(){return this.expanded},Calendar.prototype.toggleExpand=function(){var e=this.enableFade;this.setExpanded(!this.expanded,e)},Calendar.prototype.setExpanded=function(e,t){if(this.drawFixedExpanded&&(e=!0),this.expanded!=e||!this.didInit){var a=this.getOtherCalendar();this.drawDivBox&&e&&a&&a.expanded&&a.setExpanded(!1,!1),t?(this.fadeLines=0,this._fadeCalendar(e)):(this.expanded=e,this.writeCalendar(),calResetDimensions(this,a))}},Calendar.prototype._fadeCalendar=function(e){var t=this.getOtherCalendar();if(this.enableFade&&this.fadeLines<=4){var a=e?this.fadeLines:4-this.fadeLines,n=4-a;this._writeCalendar(!0,a),t&&t._writeCalendar(!0,n),this.fadeLines++,setTimeout(this.calVarName+"._fadeCalendar("+e+")",FADE_INTERVAL_MS)}else this.expanded=e,this.writeCalendar(),t&&t.setExpanded(!this.expanded,!1)},Calendar.prototype.setDate=function(e,t,a){var n=this.year,i=this.month1,s=this.selDay;this.year=parseInt(e),this.month1=parseInt(t),this.month1<1&&(this.month1=1),12<this.month1&&(this.month1=12),this.selDay=parseInt(a),this.constrainSelectedDay(!0),n==this.year&&i==this.month1&&s==this.selDay||(this.selHour=this.eodHour,this.selMin=this.eodMin),this.setFormDate(),this.writeCalendar()},Calendar.prototype.setDateAsString=function(e){if(e){var t=e.indexOf("/"),a=0<=t?e.indexOf("/",t+1):0,n=0<t?parseInt(e.substring(0,t)):2013,i=0<a?parseInt(e.substring(t+1,a)):1,s=0<a?parseInt(e.substring(a+1)):1,o=0==n?2e3:n<1900?1900:n,r=0==i?1:12<i?12:i,l=0==s?1:31<s?1:s;this.setDate(o,r,l)}},Calendar.prototype.getDateAsString=function(){var e=this.year,t=this.month1<=9?"0"+this.month1:this.month1,a=this.selDay<=9?"0"+this.selDay:this.selDay;this.selHour,this.selHour,this.selMin,this.selMin;return e+"/"+t+"/"+a},Calendar.prototype.gotoPreviousYear=function(){var e=this.isSameMonthAsNextCalendar();this.year=this.year-1,this.constrainSelectedDay(!1),this.selHour=this.eodHour,this.selMin=this.eodMin,this.setFormDate(),this.writeCalendar(),e&&this.nextCal.writeCalendar(),this.isSameMonthAsPriorCalendar()&&this.priorCal.writeCalendar()},Calendar.prototype.gotoNextYear=function(){var e=this.isSameMonthAsPriorCalendar();this.year=this.year+1,this.constrainSelectedDay(!1),this.selHour=this.eodHour,this.selMin=this.eodMin,this.setFormDate(),this.writeCalendar(),e&&this.priorCal.writeCalendar(),this.isSameMonthAsNextCalendar()&&this.nextCal.writeCalendar()},Calendar.prototype.gotoPreviousMonth=function(){var e=this.isSameMonthAsNextCalendar();this.month1=this.month1-1,this.month1<=0&&(this.month1=12,this.year=this.year-1),this.constrainSelectedDay(!1),this.selHour=this.eodHour,this.selMin=this.eodMin,this.setFormDate(),this.writeCalendar(),e&&this.nextCal.writeCalendar(),this.isSameMonthAsPriorCalendar()&&this.priorCal.writeCalendar()},Calendar.prototype.gotoNextMonth=function(){var e=this.isSameMonthAsPriorCalendar();this.month1=this.month1+1,12<this.month1&&(this.month1=1,this.year=this.year+1),this.constrainSelectedDay(!1),this.selHour=this.eodHour,this.selMin=this.eodMin,this.setFormDate(),this.writeCalendar(),e&&this.priorCal.writeCalendar(),this.isSameMonthAsNextCalendar()&&this.nextCal.writeCalendar()},Calendar.prototype.writeCalendar=function(){this._writeCalendar(this.expanded,6),this.didInit=!0},Calendar.prototype._writeCalendar=function(e,t){this.year;var a=this.daysInMonth(this.year,this.month1),n=this.daysInMonth(this.year,this.month1-1),i=CalMonthNames[this.month1-1],s=(""+this.year).substring(2),o=this.dayOfWeek(this.year,this.month1,1),r=this.calID+CAL_ID_TABLE,l=this.calID+CAL_ID_DATE,p=this.calID+CAL_ID_TIME,h=this.calID+CAL_ID_TIME_HH,d=this.calID+CAL_ID_TIME_MM,u=this.calID+CAL_ID_DAY,c=6!=t,_=document.getElementById(this.calID);if(_){var m="";m+="<table id='"+r+"' class='"+CLASS_CAL_TABLE+"' cellspacing='0' cellpadding='0'>\n";var g="",L="";if(this.drawClickBar){L="cursor:pointer;";var E=null!=this.priorCal;if(m+="<tr>",c)m+="<td class='"+CLASS_CAL_EXPAND_BAR+"'>";else{e?(g="javascript:"+this.calVarName+".toggleExpand();",m+="<td class='"+CLASS_CAL_EXPAND_BAR+"' onclick=\""+g+'" title="'+TOOLTIP_COLLAPSE+'">'):(g="javascript:"+this.calVarName+".toggleExpand();",m+="<td class='"+CLASS_CAL_COLLAPSE_BAR+"' onclick=\""+g+'" title="'+TOOLTIP_EXPAND+'">');var f=null;f=this.drawDivBox?e?"/images/arrowUp3.png":"/images/arrowDn3.png":E!=e?"/images/arrowUp3.png":"/images/arrowDn3.png",m+='<img src="'+calImageBaseDir+f+"\" height='5'>"}m+="</td>",m+="</tr>\n"}if(m+="<tr><td class='"+CLASS_CAL_TITLE_DATE_CELL+"'>\n",m+="<table class='"+CLASS_CAL_TITLE_TABLE+"' cellspacing='0' cellpadding='0'>\n",m+="<tr>\n",e||this.drawFixedExpanded){var S=this.drawClickBar&&!c?TOOLTIP_COLLAPSE:"";if(m+="<td class='"+CLASS_CAL_TITLE_FIELD_EXP+"' style='"+L+"' title=\""+S+'" onclick="'+g+'">'+this.title+"</td>\n",m+="<td class='"+CLASS_CAL_DATE_TIME_EXP+"' style='"+L+"' nowrap title=\""+S+'">',m+="<span class='"+CLASS_CAL_DATE_FIELD+"' id='"+l+"' onclick=\""+g+'"></span>&nbsp;',m+="<span style='color:#999999'>|</span>&nbsp;",this.enabled)if(c)m+="<span class='"+CLASS_CAL_TIME_EXP+"' id='"+p+"'></span>";else if(calTextTimeEntry){m+="<input class='"+CLASS_CAL_TIME_EXP+"' id='"+h+"' title='"+TOOLTIP_SET_HOUR+"'onkeypress=\"javascript:return "+this.calVarName+'.timeDigitKey(event,0);" onchange="javascript:'+this.calVarName+".setInputHour();\" size='2' maxlength='2' style='border:0; margin:0; padding:0; width:13px;'></input>",m+="<span class='"+CLASS_CAL_TIME_EXP_COLON+"'>:</span>",m+="<input class='"+CLASS_CAL_TIME_EXP+"' id='"+d+"' title='"+TOOLTIP_SET_MINUTE+"'onkeypress=\"javascript:return "+this.calVarName+'.timeDigitKey(event,1);" onchange="javascript:'+this.calVarName+".setInputMinute();\" size='2' maxlength='2' style='border:0; margin:0; padding:0; width:13px;'></input>"}else m+="<a class='"+CLASS_CAL_TIME_EXP+"' id='"+h+"' href=\"javascript:"+this.calVarName+".advanceHour(1);\" title='"+TOOLTIP_SET_HOUR+"'></a>",m+="<span class='"+CLASS_CAL_TIME_EXP_COLON+"'>:</span>",m+="<a class='"+CLASS_CAL_TIME_EXP+"' id='"+d+"' href=\"javascript:"+this.calVarName+".advanceMinute(5);\" title='"+TOOLTIP_SET_MINUTE+"'></a>";else m+="<span class='"+CLASS_CAL_TIME_DISABLED+"' id='"+p+"'></span>";m+="</td>\n"}else{S=c?"":TOOLTIP_EXPAND;m+="<td class='"+CLASS_CAL_TITLE_FIELD_COLL+"' title=\""+S+'" onclick="'+g+'">'+this.title+"</td>\n",m+="<td class='"+CLASS_CAL_DATE_TIME_COLL+"' title=\""+S+'">',m+="<span class='"+CLASS_CAL_DATE_FIELD+"' id='"+l+"' onclick=\""+g+'"></span>&nbsp;',m+="<span style='color:#999999'>|</span>&nbsp;",this.enabled?m+="<a class='"+CLASS_CAL_TIME_COLL+"' id='"+p+"' href=\""+g+'"></a>':m+="<span class='"+CLASS_CAL_TIME_DISABLED+"' id='"+p+"'></span>",m+="</td>\n"}m+="</td>\n",m+="</tr>\n",m+="</table>\n",m+="</td></tr>\n";var T="";if(e||this.drawFixedExpanded){T+="<tr><td>\n",T+="<table class='"+CLASS_CAL_MONTH_HEADER_TBL+"' cellspacing='0' cellpadding='0'>\n",T+="<tr>\n";var M="&#9669;",A="&#9668;",v="&#9659;",D="&#9658;",y="&nbsp;&nbsp;&nbsp;",C="&nbsp;&nbsp;";this.enabled?this.isSameMonthAsPriorCalendar()?(T+="<td class='"+CLASS_CAL_MONTH_ADVANCE+"' nowrap><b>"+C,this.showYearAdv&&(T+="<span style='color:gray;'>"+M+"</span>"),T+=y+"<span style='color:gray;'>"+A+"</span></b></td>\n"):(T+="<td class='"+CLASS_CAL_MONTH_ADVANCE+"' nowrap><b>"+C,this.showYearAdv&&(T+="<a class='"+CLASS_CAL_MONTH_ADV_CLICK+"' href=\"javascript:"+this.calVarName+'.gotoPreviousYear()" title="'+TOOLTIP_PREV_YEAR+'">'+M+"</a>"),T+=y+"<a class='"+CLASS_CAL_MONTH_ADV_CLICK+"' href=\"javascript:"+this.calVarName+'.gotoPreviousMonth()" title="'+TOOLTIP_PREV_MONTH+'">'+A+"</a></b></td>\n"):T+="<td class='"+CLASS_CAL_MONTH_ADVANCE+"'>&nbsp;</td>\n",T+="<td class='"+CLASS_CAL_MONTH_NAME+"' width='100%' nowrap><center><b>"+i+" '"+s+"</b></center></td>\n",this.enabled?(this.isSameMonthAsNextCalendar()?(T+="<td class='"+CLASS_CAL_MONTH_ADVANCE+"' nowrap><b><span style='color:gray;'>"+D+"</span>"+y,this.showYearAdv&&(T+="<span style='color:gray;'>"+v+"</span>")):(T+="<td class='"+CLASS_CAL_MONTH_ADVANCE+"' nowrap><b><a class='"+CLASS_CAL_MONTH_ADV_CLICK+"' href=\"javascript:"+this.calVarName+'.gotoNextMonth()" title="'+TOOLTIP_NEXT_MONTH+'">'+D+"</a>"+y,this.showYearAdv&&(T+="<a class='"+CLASS_CAL_MONTH_ADV_CLICK+"' href=\"javascript:"+this.calVarName+'.gotoNextYear()" title="'+TOOLTIP_NEXT_YEAR+'">'+v+"</a>")),T+=C+"</b></td>\n"):T+="<td class='"+CLASS_CAL_MONTH_ADVANCE+"'>&nbsp;</td>\n",T+="</tr>\n",T+="</table>\n",T+="</td></tr>\n",T+="<tr><td class='"+CLASS_CAL_MONTH_DAYS_CELL+"'>\n",T+="<table class='"+CLASS_CAL_MONTH_DAYS_TBL+"' cellspacing='0' cellpadding='0'>\n",T+="<tr>\n";for(var P=0;P<7;P++){var R=(P+calFirstDOW)%7;T+="<td class='"+CLASS_CAL_MONTH_DOW+"'><b>"+CalDayNames[R]+"</b></td>\n"}T+="</tr>\n";for(var I=-(o-calFirstDOW+7)%7,O=0;O<7*t;){T+="<tr>\n";for(P=0;P<7;P++){R=(P+calFirstDOW)%7;if(I<0)T+="<td class='"+CLASS_CAL_PREV_MONTH_DAYS+"'><b>"+(N=I+n+1)+"</b></td>\n";else if(a<=I){T+="<td class='"+CLASS_CAL_NEXT_MONTH_DAYS+"'><b>"+(N=I-a+1)+"</b></td>\n"}else{var N=I+1;this.enabled?T+="<td class='"+CLASS_CAL_MONTH_DAYS_ENABLE+"' id='"+u+"."+N+"' onclick=\"javascript:"+this.calVarName+".selectDay("+N+');"><b>'+N+"</b></td>\n":T+="<td class='"+CLASS_CAL_MONTH_DAYS_DISABL+"' id='"+u+"."+N+"'><b>"+N+"</b></td>\n"}I++,O++}T+="</tr>\n"}T+="</table>\n",T+="</td></tr>\n"}if(this.drawDivBox){if(_.innerHTML=m+"</table>\n",this._divCloseCalendar(),""!=T){var b=getElementPosition(_),j=getElementSize(_);this.divCalView=createDivBox(CLASS_CAL_DIV,b.left+1,b.top+j.height+1,-1,-1),this.divCalView.innerHTML="<table class='"+CLASS_CAL_TABLE+"' cellspacing='0' cellpadding='0'>\n"+T+"</table>\n",document.body.appendChild(this.divCalView)}}else _.innerHTML=m+T+"</table>\n";this._selectDay(this.selDay,this.selHour,this.selMin)}else alert("Element not found: "+this.calID)},Calendar.prototype._divCloseCalendar=function(){null!=this.divCalView&&(document.body.removeChild(this.divCalView),this.divCalView=null,this.divOnmousedown&&(document.onmousedown=this.divOnmousedown,this.divOnmousedown=null))},Calendar.prototype.timeDigitKey=function(e,t){if(!this.enabled)return!0;var a=getKeyCode(e);if(48<=a&&a<=57)return!0;if(8==a)return!0;if(9==a)return!0;if(37==a||39==a)return!0;if(38==a||33==a||117==a||85==a){var n=33==a||e.ctrlKey||e.shiftKey?10:1;return t?(this.setInputMinute(),this.advanceMinute(n)):(this.setInputHour(),this.advanceHour(n)),!1}if(40==a||34==a||100==a||68==a){var i=34==a||e.ctrlKey||e.shiftKey?-10:-1;return t?(this.setInputMinute(),this.advanceMinute(i)):(this.setInputHour(),this.advanceHour(i)),!1}return 36==a||104==a||72==a?(t?this.selMin=0:this.selHour=0,this.setFormDate()):(35==a||101==a||69==a)&&(t?this.selMin=59:this.selHour=23,this.setFormDate()),!1};var ID_DEVICE_ID="deviceSelector",ID_DEVICE_DESCR="deviceDescription",ID_GOTO_ADDRESS="gotoAddressFld",PAGE_ZONEGEOCODE="ZONEGEOCODE",TAG_geocode="geocode",TAG_geonames="geonames",TAG_code="code",TAG_geoname="geoname",TAG_lat="lat",TAG_lng="lng",TAG_lon="lon",trackMapLimitOverride=-1;function trackMapEventLimit(){return IS_FLEET?-1:trackMapLimitOverride}function trackMapOnLoad(){var e=document.getElementById(ID_MAP_AUTOUPDATE_BTN);if(null!=e&&(e.value=AutoUpdateEnable?TEXT_autoUpdateStart:"??"),ControlCollapseOnLoad&&jsmControlDisplay(!1),AutoUpdateOnLoad){var t=AutoUpdateRecenterMode;AutoUpdateRecenterMode=jsmRecenterZoomMode(RECENTER_ZOOM),startAutoUpdateMapTimer(),AutoUpdateRecenterMode=t}else{trackMapUpdateMap("last"!=MapUpdateOnLoad||IS_FLEET?trackMapEventLimit():1,trackMapLimitType(),jsmRecenterZoomMode(RECENTER_ZOOM),0)}}function trackMapOnUnload(){mapProviderUnload()}function trackMapSelectRegion(){jsmDrawShape("!");var e=null;if(trackZoomRegionShapes){var t=document.SelectDeviceForm.regionSelector.value;if(""!=t&&"normal"!=t)for(var a=0;a<trackZoomRegionShapes.length;a++)if(t==trackZoomRegionShapes[a].name){e=trackZoomRegionShapes[a];break}}if(null==e)return jsmSetFixedZoom(!1),void trackMapClickedUpdateAll();var n=e.color,i=e.type,s=e.radius,o=e.points.split(","),r=[];for(a=0;a<o.length;a++){var l=o[a].split("/");if(!(l.length<2)){var p=numParseFloat(l[0],0),h=numParseFloat(l[1],0);0==p&&0==h||r.push(new JSMapPoint(p,h))}}return 0==r.length?(jsmSetFixedZoom(!1),void trackMapClickedUpdateAll()):"zoom"==i||"!zoom"==i?(jsmSetCenter(r[0].lat,r[0].lon,s),void jsmSetFixedZoom(!0)):void(jsmDrawShape(i,s,r,n,!0,"",-1)?jsmSetFixedZoom(!0):jsmSetFixedZoom(!1))}function _resetCalandarDates(){if(!IS_FLEET&&jsvLastEventYMD&&0<jsvLastEventEpoch){if(mapCal_to){var e=jsvLastEventYMD.DD+1;mapCal_to.setDate(jsvLastEventYMD.YYYY,jsvLastEventYMD.MM,e)}if(mapCal_fr){e=jsvLastEventYMD.DD;mapCal_fr.setDate(jsvLastEventYMD.YYYY,jsvLastEventYMD.MM,e)}}else if(jsvTodayYMD){if(mapCal_to){e=jsvTodayYMD.DD+1;mapCal_to.setDate(jsvTodayYMD.YYYY,jsvTodayYMD.MM,e)}if(mapCal_fr){e=jsvTodayYMD.DD;mapCal_fr.setDate(jsvTodayYMD.YYYY,jsvTodayYMD.MM,e)}}}function trackMapGotoLastEventDate(){_resetCalandarDates(),trackMapClickedUpdateAll()}function trackMapPingDevice(e){if(!IS_FLEET&&mapDevicePing&&DEVICE_PING_URL&&""!=DEVICE_PING_URL){var t=document.SelectDeviceForm.device.value,a=mapCal_fr.getArgDateTime(),n=mapCal_to.getArgDateTime(),i=calGetTimeZone();mapDevicePing(DEVICE_PING_URL+"&_uniq="+Math.random()+"&"+PARM_RANGE_FR+"="+strEncode(a)+"&"+PARM_RANGE_TO+"="+strEncode(n)+"&"+PARM_TIMEZONE+"="+strEncode(i)+"&"+PARM_DEVICE_GROUP+"="+strEncode(t)+"&"+PARM_DEVICE_COMMAND+"="+strEncode(e||""))}}function trackMapLimitType(){return LimitType}function trackMapClickedUpdateAll(){AutoUpdateOnLoad&&null!=AutoUpdateMapTimer?startAutoUpdateMapTimer():(stopAutoUpdateMapTimer(),trackMapUpdateMap(trackMapEventLimit(),trackMapLimitType(),jsmRecenterZoomMode(RECENTER_ZOOM),0))}function trackMapClickedUpdateLast(){stopAutoUpdateMapTimer(),trackMapUpdateMap(1,"last",jsmRecenterZoomMode(RECENTER_ZOOM),0)}function trackMapClickedReplay(e){stopAutoUpdateMapTimer();var t=e?2:1;0<mapProviderPauseReplay(t)||trackMapUpdateMap(trackMapEventLimit(),trackMapLimitType(),jsmRecenterZoomMode(RECENTER_ZOOM),t)}function trackMapUpdateMap(e,t,a,n){var i=$("#selectedDeviceId").val(),s=mapCal_fr?mapCal_fr.getArgDateTime():"",o=mapCal_to?mapCal_to.getArgDateTime():"",r=calGetTimeZone(),l=MAP_UPDATE_URL+"&_uniq="+Math.random()+"&"+PARM_RANGE_FR+"="+strEncode(s)+"&"+PARM_RANGE_TO+"="+strEncode(o)+"&"+PARM_TIMEZONE+"="+strEncode(r)+"&"+PARM_DEVICE_GROUP+"="+strEncode(i);0<e&&(l+="&"+PARM_LIMIT+"="+e),""!=t&&(l+="&"+PARM_LIMIT_TYPE+"="+t),mapProviderUpdateMap(l,a,n)}function trackMapUpdateKML(){if(KML_UPDATE_URL&&""!=KML_UPDATE_URL){var e=mapCal_fr?mapCal_fr.getArgDateTime():"",t=mapCal_to.getArgDateTime(),a=calGetTimeZone();openURL(KML_UPDATE_URL+"&_uniq="+Math.random()+"&"+PARM_RANGE_FR+"="+strEncode(e)+"&"+PARM_RANGE_TO+"="+strEncode(t)+"&"+PARM_TIMEZONE+"="+strEncode(a)+"&"+PARM_DEVICE_GROUP+"="+strEncode("863071014829169"),"_blank")}}function trackMapClickedAutoUpdate(){null!=AutoUpdateMapTimer?stopAutoUpdateMapTimer():startAutoUpdateMapTimer()}var _autoUpdateButtonElem=null;function _setAutoUpdateButtonText(e){null==_autoUpdateButtonElem&&(_autoUpdateButtonElem=document.getElementById(ID_MAP_AUTOUPDATE_BTN)),null!=_autoUpdateButtonElem&&(_autoUpdateButtonElem.value=e)}function _timerAutoUpdateMap(){if(--AutoIntervalCount<=0){if(_resetCalandarDates(),trackMapUpdateMap("last"!=MapUpdateOnLoad||IS_FLEET?trackMapEventLimit():1,"last",jsmRecenterZoomMode(AutoUpdateRecenterMode),0),0<AutoMaxCount&&++AutoUpdateMapCount>=AutoMaxCount)return void stopAutoUpdateMapTimer();AutoIntervalCount=AutoInterval}_setAutoUpdateButtonText(TEXT_autoUpdateStop+" : "+AutoIntervalCount)}function startAutoUpdateMapTimer(){stopAutoUpdateMapTimer(),_resetCalandarDates(),trackMapUpdateMap("last"!=MapUpdateOnLoad||IS_FLEET?trackMapEventLimit():1,"last",jsmRecenterZoomMode(AutoUpdateRecenterMode),0),AutoIntervalCount=AutoInterval,AutoUpdateMapCount=0,_setAutoUpdateButtonText(TEXT_autoUpdateStop),AutoUpdateMapTimer=setInterval("_timerAutoUpdateMap()",1e3)}function stopAutoUpdateMapTimer(){null!=AutoUpdateMapTimer&&(clearInterval(AutoUpdateMapTimer),AutoUpdateMapTimer=null),AutoIntervalCount=0,AutoUpdateMapCount=0,_setAutoUpdateButtonText(TEXT_autoUpdateStart)}function trackMapShowSelector(){if(deviceShowChooserList){var e="undefined"!=typeof TrackSelectorList?TrackSelectorList:null;deviceShowChooserList(ID_DEVICE_ID,ID_DEVICE_DESCR,e)}}function deviceDeviceChanged(){trackMapSelectDevice()}function trackMapSelectDevice(){document.SelectDeviceForm.date_fr.value=mapCal_fr?mapCal_fr.getArgDateTime():"",document.SelectDeviceForm.date_to.value=mapCal_to.getArgDateTime(),document.SelectDeviceForm.date_tz.value=calGetTimeZone(),document.SelectDeviceForm.submit()}function trackMapGotoAddress(){var e=document.getElementById(ID_GOTO_ADDRESS);if(null!=e){var t=e.value,a="./Track?page="+PAGE_ZONEGEOCODE+"&addr="+t+"&country=US&_uniq="+Math.random();try{var c=jsmGetXMLHttpRequest();c?(c.open("GET",a,!0),c.onreadystatechange=function(){if(4==c.readyState){for(var e=0,t=0;;){var a=c.responseText;if(!a||""==a)break;var n=createXMLDocument(a);if(null==n)break;var i=n.getElementsByTagName(TAG_geocode);if(null!=i&&0<i.length){var s=i[0];if(null!=s){var o=s.getElementsByTagName(TAG_lat);if((u=s.getElementsByTagName(TAG_lng))&&0!=u.length||(u=s.getElementsByTagName(TAG_lon)),0<o.length&&0<u.length){e=numParseFloat(o[0].childNodes[0].nodeValue,0),t=numParseFloat(u[0].childNodes[0].nodeValue,0);break}}break}var r=n.getElementsByTagName(TAG_geonames);if(null!=r&&0<r.length){var l=r[0],p=null;if(null!=l&&((p=l.getElementsByTagName(TAG_code))&&0!=p.length||(p=l.getElementsByTagName(TAG_geoname))),null!=p)for(var h=0;h<p.length;h++){var d=p[h],u=(o=d.getElementsByTagName(TAG_lat),d.getElementsByTagName(TAG_lng));if(0<o.length&&0<u.length){e=numParseFloat(o[0].childNodes[0].nodeValue,0),t=numParseFloat(u[0].childNodes[0].nodeValue,0);break}}break}break}0==e&&0==t||(jsmDrawShape("!"),jsmDrawShape("circle",200,[new JSMapPoint(e,t)],"#888855",!0,"",-1))}else c.readyState},c.send(null)):alert("Error [trackMapGotoAddress]:\n"+a)}catch(e){alert("Error [trackMapGotoAddress]:\n"+e)}}}function _zoneMapOnLoad(){trackMapOnLoad()}function _zoneMapOnUnload(){trackMapOnUnload()}L.BingLayer=L.TileLayer.extend({options:{subdomains:[0,1,2,3],type:"Road",attribution:"Bing",culture:""},initialize:function(e,t){L.Util.setOptions(this,t),this._key=e,this._url=null,this.meta={},this.loadMetadata()},tile2quad:function(e,t,a){for(var n="",i=a;0<i;i--){var s=0,o=1<<i-1;0!=(e&o)&&(s+=1),0!=(t&o)&&(s+=2),n+=s}return n},getTileUrl:function(e,t){t=this._getZoomForUrl();var a=this.options.subdomains,n=this.options.subdomains[Math.abs((e.x+e.y)%a.length)];return this._url.replace("{subdomain}",n).replace("{quadkey}",this.tile2quad(e.x,e.y,t)).replace("{culture}",this.options.culture)},loadMetadata:function(){var a=this,n="_bing_metadata_"+L.Util.stamp(this);window[n]=function(e){a.meta=e,window[n]=void 0;var t=document.getElementById(n);t.parentNode.removeChild(t),e.errorDetails?window.console&&console.log("Leaflet Bing Plugin Error - Got metadata: "+e.errorDetails):a.initMetadata()};var e=document.location.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.options.type+"?include=ImageryProviders&jsonp="+n+"&key="+this._key+"&UriScheme="+document.location.protocol.slice(0,-1),t=document.createElement("script");t.type="text/javascript",t.src=e,t.id=n,document.getElementsByTagName("head")[0].appendChild(t)},initMetadata:function(){var e=this.meta.resourceSets[0].resources[0];if(this.options.subdomains=e.imageUrlSubdomains,this._url=e.imageUrl,this._providers=[],e.imageryProviders)for(var t=0;t<e.imageryProviders.length;t++)for(var a=e.imageryProviders[t],n=0;n<a.coverageAreas.length;n++){var i=a.coverageAreas[n],s={zoomMin:i.zoomMin,zoomMax:i.zoomMax,active:!1},o=new L.LatLngBounds(new L.LatLng(i.bbox[0]+.01,i.bbox[1]+.01),new L.LatLng(i.bbox[2]-.01,i.bbox[3]-.01));s.bounds=o,s.attrib=a.attribution,this._providers.push(s)}this._update()},_update:function(){null!=this._url&&this._map&&(this._update_attribution(),L.TileLayer.prototype._update.apply(this,[]))},_update_attribution:function(){for(var e=this._map.getBounds(),t=this._map.getZoom(),a=0;a<this._providers.length;a++){var n=this._providers[a];t<=n.zoomMax&&t>=n.zoomMin&&e.intersects(n.bounds)?(!n.active&&this._map.attributionControl&&this._map.attributionControl.addAttribution(n.attrib),n.active=!0):(n.active&&this._map.attributionControl&&this._map.attributionControl.removeAttribution(n.attrib),n.active=!1)}},onRemove:function(e){for(var t=0;t<this._providers.length;t++){var a=this._providers[t];a.active&&this._map.attributionControl&&(this._map.attributionControl.removeAttribution(a.attrib),a.active=!1)}L.TileLayer.prototype.onRemove.apply(this,[e])}}),L.bingLayer=function(e,t){return new L.BingLayer(e,t)},L.Google=L.Layer.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,mapOptions:{backgroundColor:"#dddddd"}},initialize:function(e,t){L.Util.setOptions(this,t),this._ready=null!=google.maps.Map,this._ready||L.Google.asyncWait.push(this),this._type=e||"SATELLITE"},onAdd:function(e,t){this._map=e,this._insertAtTheBottom=t,this._initContainer(),this._initMapObject(),e.on("viewreset",this._resetCallback,this),this._limitedUpdate=L.Util.throttle(this._update,150,this),e.on("move",this._update,this),e.on("zoomanim",this._handleZoomAnim,this),e._controlCorners.bottomright.style.marginBottom="20px",this._reset(),this._update()},onRemove:function(e){this._map._container.removeChild(this._container),this._map.off("viewreset",this._resetCallback,this),this._map.off("move",this._update,this),this._map.off("zoomanim",this._handleZoomAnim,this),e._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(e){(this.options.opacity=e)<1&&L.DomUtil.setOpacity(this._container,e)},setElementSize:function(e,t){e.style.width=t.x+"px",e.style.height=t.y+"px"},_initContainer:function(){var e=this._map._container,t=e.firstChild;this._container||(this._container=L.DomUtil.create("div","leaflet-google-layer leaflet-top leaflet-left"),this._container.id="_GMapContainer_"+L.Util.stamp(this),this._container.style.zIndex="auto"),e.insertBefore(this._container,t),this.setOpacity(this.options.opacity),this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(this._ready){this._google_center=new google.maps.LatLng(0,0);var e=new google.maps.Map(this._container,{center:this._google_center,zoom:0,tilt:0,mapTypeId:google.maps.MapTypeId[this._type],disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.mapOptions.styles,backgroundColor:this.options.mapOptions.backgroundColor}),t=this;this._reposition=google.maps.event.addListenerOnce(e,"center_changed",function(){t.onReposition()}),this._google=e,google.maps.event.addListenerOnce(e,"idle",function(){t._checkZoomLevels()})}},_checkZoomLevels:function(){this._google.getZoom()!==this._map.getZoom()&&this._map.setZoom(this._google.getZoom())},_resetCallback:function(e){this._reset(e.hard)},_reset:function(e){this._initContainer()},_update:function(e){if(this._google){this._resize();var t=e&&e.latlng?e.latlng:this._map.getCenter(),a=new google.maps.LatLng(t.lat,t.lng);this._google.setCenter(a),this._google.setZoom(this._map.getZoom()),this._checkZoomLevels()}},_resize:function(){var e=this._map.getSize();this._container.style.width==e.x&&this._container.style.height==e.y||(this.setElementSize(this._container,e),this.onReposition())},_handleZoomAnim:function(e){var t=e.center,a=new google.maps.LatLng(t.lat,t.lng);this._google.setCenter(a),this._google.setZoom(e.zoom)},onReposition:function(){this._google&&google.maps.event.trigger(this._google,"resize")}}),L.Google.asyncWait=[],L.Google.asyncInitialize=function(){var e;for(e=0;e<L.Google.asyncWait.length;e++){var t=L.Google.asyncWait[e];t._ready=!0,t._container&&(t._initMapObject(),t._update())}L.Google.asyncWait=[]};var DRAG_NONE=0,DRAG_RULER=1,DRAG_GEOZONE=16,DRAG_GEOZONE_CENTER=17,DRAG_GEOZONE_RADIUS=18;function LeafletColorStyle(e,t,a,n){this.strokeColor=e,this.strokeOpacity=t,this.strokeWidth=1,this.fillColor=a,this.fillOpacity=n}var GEOZONE_STYLE=[new LeafletColorStyle("#CC1111",.8,"#11CC22",.28),new LeafletColorStyle("#11CC11",.8,"#11CC22",.18)];function GetGeozoneStyle(e,t){var a=GEOZONE_STYLE[e?0:1];return t&&""!=t?new LeafletColorStyle(a.strokeColor,a.strokeOpacity,t,a.fillOpacity):a}function CreateLeafletMap(e){return CREATE_MAP_CALLBACK?CREATE_MAP_CALLBACK(e):L.map(e.id)}function JSMap(e){if(this.userAgent_MSIE=/MSIE/.test(navigator.userAgent),e.style.cursor="crosshair",this.leafletMap=CreateLeafletMap(e),this.leafletMap.setView(L.latLng(DEFAULT_CENTER.lat,DEFAULT_CENTER.lon),13),this.currentLayer=null,this.mapLayer=[],""!=LEAFLET_CUSTOM1_NAME&&""!=LEAFLET_CUSTOM1_URL){var t=this._initCustomMap(e,LEAFLET_CUSTOM1_NAME,LEAFLET_CUSTOM1_URL,LEAFLET_CUSTOM1_SUBDOMAINS,LEAFLET_CUSTOM1_MAX_ZOOM,LEAFLET_CUSTOM1_COPYRIGHT,LEAFLET_CUSTOM1_INIT_FTN);this.mapLayer.push(t)}if(""!=LEAFLET_CUSTOM2_NAME&&""!=LEAFLET_CUSTOM2_URL){t=this._initCustomMap(e,LEAFLET_CUSTOM2_NAME,LEAFLET_CUSTOM2_URL,LEAFLET_CUSTOM2_SUBDOMAINS,LEAFLET_CUSTOM2_MAX_ZOOM,LEAFLET_CUSTOM2_COPYRIGHT,LEAFLET_CUSTOM2_INIT_FTN);this.mapLayer.push(t)}if(""!=LEAFLET_CUSTOM3_NAME&&""!=LEAFLET_CUSTOM3_URL){t=this._initCustomMap(e,LEAFLET_CUSTOM3_NAME,LEAFLET_CUSTOM3_URL,LEAFLET_CUSTOM3_SUBDOMAINS,LEAFLET_CUSTOM3_MAX_ZOOM,LEAFLET_CUSTOM3_COPYRIGHT,LEAFLET_CUSTOM3_INIT_FTN);this.mapLayer.push(t)}var a=L.tileLayer("https://api.mapbox.com/styles/v1/mapbox/emerald-v8/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoicmFteWFzaXZoIiwiYSI6ImNqZWIzd3kxbjBiczMzM2xhanlubzBsbDYifQ.vYDOlHTViIY-OAiTNFd_1A",{tileSize:512,zoomOffset:-1,attribution:'© <a href="https://www.mapbox.com/feedback/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'});a.gtsMapName="mapbox",this.mapLayer.push(a);var n=new L.BingLayer("Anqm0F_JjIZvT0P3abS6KONpaBaKuTnITRrnYuiJCE0WOhH6ZbE4DzeT6brvKVR5");n.gtsMapName="bing",this.mapLayer.push(n);var i=new L.Google("ROADMAP");if(i.gtsMapName="google",this.mapLayer.push(i),LEAFLET_ADD_OPEN_STREET_MAP){t=this._initOpenStreetMap(e);this.mapLayer.push(t)}if(0<this.mapLayer.length?(this.currentLayer=this.mapLayer[0],this.leafletMap.addLayer(this.currentLayer)):console.log("WARN: no map layers added!"),""!=LEAFLET_ATTRIBUTION_PREFIX){var s="blank"==LEAFLET_ATTRIBUTION_PREFIX?"":LEAFLET_ATTRIBUTION_PREFIX;this.leafletMap.attributionControl.setPrefix(s)}this.centerBounds=new JSBounds,this.rulerFeatures=null,this.rulerLayer=null;try{this.rulerLayer=L.featureGroup(),this.leafletMap.addLayer(this.rulerLayer)}catch(e){alert("Error: Creating ruler layer - "+e)}this.poiLayer=null;try{this.poiLayer=L.featureGroup(),this.leafletMap.addLayer(this.poiLayer)}catch(e){alert("Error: Creating POI layer - "+e)}this.routeLines=[],this.primaryIndex=-1,this.primaryCenter=null,this.geozonePoints=null,this.dragZoneOffsetLat=0,this.dragZoneOffsetLon=0,this.drawFeatures=null,this.drawShapes=[],this.drawLayer=[];try{this.drawLayer.push(L.featureGroup()),this.leafletMap.addLayer(this.drawLayer[this.drawLayer.length-1])}catch(e){alert("Error: Creating Draw layer - "+e)}this.markerLayer=null;try{this.markerLayer=L.featureGroup(),this.markerLayer.addTo(this.leafletMap)}catch(e){alert("Error: Creating Marker layer - "+e)}this.replayTimer=null,this.replayIndex=0,this.replayInterval=REPLAY_INTERVAL<100?100:REPLAY_INTERVAL,this.replayInProgress=!1,this.replayPushpins=[],this.dragType=DRAG_NONE,this.dragRulerStart=null,this.dragRulerEnd=null,this.keyShfPress=!1,this.keyCtlPress=!1,this.keyAltPress=!1;try{var o=this;this.leafletMap.on("mousemove",function(e){o._event_OnMouseMove(e)}),this.leafletMap.on("mousedown",function(e){o._event_OnMouseDown(e)}),this.leafletMap.on("mouseup",function(e){o._event_OnMouseUp(e)}),this.leafletMap.on("click",function(e){o._event_OnClick(e)}),this.leafletMap.on("popupopen",function(e){o._event_PopupOpen(e)}),this.leafletMap.on("popupclose",function(e){o._event_PopupClose(e)}),L.DomEvent.on(document,"keydown",function(e){switch(e.keyCode){case 16:o.keyShfPress=!0;break;case 17:o.keyCtlPress=!0;break;case 18:o.keyAltPress=!0}}),L.DomEvent.on(document,"keyup",function(e){switch(e.keyCode){case 16:o.keyShfPress=!1;break;case 17:o.keyCtlPress=!1;break;case 18:o.keyAltPress=!1}}),this.leafletMap.on("contextmenu",function(e){o._event_ContextMenu(e)})}catch(e){alert("Event Handler Error: "+e)}if(jsmSetLatLonDisplay(0,0),this.lastMapZoom=0,this.lastMapSize=L.point(0,0),POST_MAP_INIT_CALLBACK)try{POST_MAP_INIT_CALLBACK(this)}catch(e){console.log("Post map init callback error: "+e)}}function angleFromCoordinate(e,t,a,n){var i=n-t,s=Math.sin(i)*Math.cos(a),o=Math.cos(e)*Math.sin(a)-Math.sin(e)*Math.cos(a)*Math.cos(i),r=Math.atan2(s,o);return r=((r=toDegrees(r))+360)%360}function toDegrees(e){return e*(180/Math.PI)}JSMap.prototype.changeMapLayer=function(e){if(this.currentLayer.gtsMapName==e);else if(1<this.mapLayer.length)for(var t=0;t<this.mapLayer.length;t++){var a=this.mapLayer[t];if(a.gtsMapName==e)return console.log("Layer changed.."),this.leafletMap.removeLayer(this.currentLayer),this.currentLayer=a,void this.leafletMap.addLayer(this.currentLayer)}},JSMap.prototype._toJSMapPointLatLon=function(e,t){return new JSMapPoint(e,t)},JSMap.prototype._toJSMapPoint=function(e){return this._toJSMapPointLatLon(e.lat,e.lng)},JSMap.prototype._toLeafletPointLatLon=function(e,t){return L.latLng(e,t)},JSMap.prototype._toLeafletPoint=function(e){return this._toLeafletPointLatLon(e.lat,e.lon)},JSMap.prototype._toLeafletPointArray=function(e){var t=[];if(e&&0<e.length)for(var a=0;a<e.length;a++)t.push(this._toLeafletPoint(e[a]));return t},JSMap.prototype._toLeafletBounds=function(e){return L.latLngBounds([[e.minLat,e.minLon],[e.maxLat,e.maxLon]])},JSMap.prototype._getMapResolution=function(){var e=this.leafletMap.getSize(),t=this.leafletMap.getBounds(),a=t.getWest(),n=t.getEast();return a<=n?(n-a)/e.x:(n-a+360)/e.x},JSMap.prototype._initOpenStreetMap=function(e){console.log("Leaflet: Initializing OSM ...");var t=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{subdomains:"abc",maxZoom:19,attribution:'&copy;<a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'});return t.gtsMapName="rede",t},JSMap.prototype._initOpenCycleMap=function(e){console.log("Leaflet: Initializing OpenCycleMap ...");var t=L.tileLayer("http://{s}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png",{subdomains:"abc",maxZoom:18,attribution:'&copy;<a href="http://www.openstreetmap.org/copyright">OpenCycleMap</a>'});return t.gtsMapName="OSM Cycle",t},JSMap.prototype._initCustomMap=function(e,t,a,n,i,s,o){console.log("Leaflet: Initializing custom map: "+t);var r=L.tileLayer(a,{subdomains:n,maxZoom:i,attribution:s});if(r.gtsMapName=t,o)try{o(this)}catch(e){console.log("ERROR: Custom Map init: "+t+" - "+e)}return r},JSMap.prototype.JSUnload=function(){},JSMap.prototype.JSClearLayers=function(){this._hidePushpinPopup(),this._clearPoiLayer(),this._clearMarkerLayer(),this._removeShapes(),this._clearRulerLayer(!0),this.centerBounds=new JSBounds,this.routeLines=[]},JSMap.prototype._clearPoiLayer=function(){if(null!==this.poiLayer){try{this.poiLayer.clearLayers()}catch(e){}try{this.leafletMap.removeLayer(this.poiLayer)}catch(e){}}},JSMap.prototype._clearMarkerLayer=function(){if(null!==this.markerLayer){try{var e=this.markerLayer.getLayers();if(null!==e)for(var t=0;t<e.length;t++)e[t].closePopup(),e[t].unbindPopup(),this.markerLayer.removeLayer(e[t])}catch(e){console.log("ERROR[_clearMarkerLayer]: "+e)}try{this.markerLayer.clearLayers()}catch(e){}try{this.leafletMap.removeLayer(this.markerLayer)}catch(e){}}this._clearReplay()},JSMap.prototype.JSPauseReplay=function(e){return!e||e<=0||!this.replayInProgress?(this._clearReplay(),REPLAY_STOPPED):null===this.replayTimer?(this._hidePushpinPopup(),jsmHighlightDetailRow(-1,!1),this._startReplayTimer(e,100),REPLAY_RUNNING):(this._stopReplayTimer(),REPLAY_PAUSED)},JSMap.prototype._startReplayTimer=function(e,t){this.replayInProgress&&(this.replayTimer=setTimeout("jsmap._replayPushpins("+e+")",t)),jsmSetReplayState(REPLAY_RUNNING)},JSMap.prototype._stopReplayTimer=function(){null!==this.replayTimer&&(clearTimeout(this.replayTimer),this.replayTimer=null),jsmSetReplayState(this.replayInProgress?REPLAY_PAUSED:REPLAY_STOPPED)},JSMap.prototype._clearReplay=function(){this.replayPushpins=[],this.replayInProgress=!1,this._stopReplayTimer(),this.replayIndex=0,jsmHighlightDetailRow(-1,!1)},JSMap.prototype._getReplayState=function(){return this.replayInProgress?null===this.replayTimer?REPLAY_PAUSED:REPLAY_RUNNING:REPLAY_STOPPED},JSMap.prototype._clearRulerLayer=function(e){if(null!==this.rulerLayer&&null!==this.rulerFeatures){try{for(var t=0;t<this.rulerFeatures.length;t++)this.rulerLayer.removeLayer(this.rulerFeatures[t])}catch(e){console.log("ERROR[_clearRulerLayer]: "+e)}this.rulerFeatures=null}e&&(this.dragRulerStart=null,this.dragRulerEnd=null)},JSMap.prototype._drawRuler=function(e){if(this._clearRulerLayer(!1),this.rulerFeatures=e,null!==this.rulerFeatures){null===this.rulerLayer&&(this.rulerLayer=L.featureGroup(),this.leafletMap.addLayer(this.rulerLayer));for(var t=0;t<this.rulerFeatures.length;t++)this.ruleLayer.addLayer(this.rulerFeatures[t])}},JSMap.prototype._createRulerFeature=function(e,t){if(null!==e&&null!==t){var a=[];return a.push(this._toLeafletPoint(e)),a.push(this._toLeafletPoint(t)),L.polyline(a,{stroke:!0,color:"#FF6422",weight:2,opacity:1,lineCap:"round",lineJoin:"round",fill:!1})}return null},JSMap.prototype._clearDrawLayer=function(){if(null!==this.drawFeatures){for(var e=0;e<this.drawFeatures.length;e++)try{this.drawLayer[0].removeLayer(this.drawFeatures[e])}catch(e){console.log("ERROR[_clearDrawLayer]: "+e)}this.drawFeatures=null}},JSMap.prototype._drawFeatures=function(e,t){if(e&&this._clearDrawLayer(),t){this.drawFeatures||(this.drawFeatures=[]);for(var a=0;a<t.length;a++)this.drawFeatures.push(t[a])}if(this.drawFeatures&&0<this.drawFeatures.length)for(a=0;a<this.drawFeatures.length;a++)this.drawLayer[0].addLayer(this.drawFeatures[a]);try{this.leafletMap.addLayer(this.drawLayer[0])}catch(e){console.log(e)}},JSMap.prototype.JSSetCenter=function(e,t){try{var a=this._toLeafletPoint(e);if(t&&0!=t)if(0<t)this.leafletMap.setView(a,t);else{var n=L.latLngBounds();n.extend(a),t=this.leafletMap.getBoundsZoom(n),this.leafletMap.setView(a,t)}else this.leafletMap.setView(a,this.leafletMap.getZoom())}catch(e){}},JSMap.prototype.JSDrawPushpins=function(e,t,a){if(!jsvGeozoneMode){this._hidePushpinPopup();var n=[];this.centerBounds||(this.centerBounds=new JSBounds);var i=0;if(null!==e&&0<e.length){for(var s=0;s<e.length;s++){!(d=e[s]).show||0==d.lat&&0==d.lon||(i++,this.centerBounds.extend(d),n.push(d))}var o=this.centerBounds.getCenter(),r=geoRadiusPoint(o.lat,o.lon,400,0);this.centerBounds.extend(r);var l=geoRadiusPoint(o.lat,o.lon,400,180);this.centerBounds.extend(l)}if(0<t){var p,h;if(i<=0)p=this._toLeafletPoint(DEFAULT_CENTER),h=DEFAULT_ZOOM;else if(t==RECENTER_LAST){var d=n[n.length-1];p=this._toLeafletPoint(d),h=this.leafletMap.getBoundsZoom(this._toLeafletBounds(this.centerBounds))}else if(t==RECENTER_PAN){d=n[n.length-1];p=this._toLeafletPoint(d),h=this.leafletMap.getZoom()}else p=this._toLeafletPoint(this.centerBounds.getCenter()),h=this.leafletMap.getBoundsZoom(this._toLeafletBounds(this.centerBounds));try{this.leafletMap.setView(p,h)}catch(e){return void alert("Error: [JSDrawPushpins] (pointCount="+i+", recenterMode="+t+", center="+p+", zoom="+h+") "+e)}}if(!(i<=0)){if(a&&1<=a)return this.leafletMap.addLayer(this.markerLayer),this.replayIndex=0,this.replayInProgress=!0,this.replayPushpins=n,void this._startReplayTimer(a,100);var u=null;for(s=0;s<n.length;s++){d=n[s];try{d.hoverPopup=!1,this._addPushpin(d,this.markerLayer)}catch(e){null===u&&(u=e)}}try{this.leafletMap.addLayer(this.markerLayer)}catch(e){null===u&&(u=e)}null!==u&&alert("Error: adding pushpins:\n"+u)}}},JSMap.prototype.JSDrawPOI=function(e){if(this._clearPoiLayer(),this._hidePushpinPopup(),null!==e&&0<e.length){for(var t=null,a=0;a<e.length;a++){var n=e[a];try{n.hoverPopup=!1,this._addPushpin(n,this.poiLayer)}catch(e){null===t&&(t=e)}}try{this.leafletMap.addLayer(this.poiLayer)}catch(e){null===t&&(t=e)}null!==t&&alert("Error: adding pushpins:\n"+t)}},JSMap.prototype._addPushpin=function(e,t){try{e.map=this.leafletMap;var a=null;if(e.iconUrl){var n=L.icon({iconUrl:e.iconUrl,iconSize:[e.iconSize[0],e.iconSize[1]],iconAnchor:[e.iconHotspot[0],e.iconHotspot[1]],popupAnchor:[0,3-e.iconHotspot[1]]});a=L.marker(this._toLeafletPoint(e),{icon:n,clickable:!0,draggable:!1,title:"",zIndexOffset:10*e.ppNdx}),e.showDeviceLabel&&e.evRcd.device&&a.bindTooltip(e.evRcd.device,{permanent:!0,direction:"top"})}var i=null;if(e.bgUrl){var s=L.icon({iconUrl:e.bgUrl,iconSize:[e.bgSize[0],e.bgSize[1]],iconAnchor:[e.bgOffset[0],e.bgOffset[1]],popupAnchor:[0,3-e.iconHotspot[1]]});i=L.marker(this._toLeafletPoint(e),{icon:s,clickable:!1,draggable:!1,zIndexOffset:10*e.ppNdx+1})}e.getHTML()&&(e.popup=L.popup().setLatLng(this._toLeafletPoint(e)).setContent(e.getHTML()),a.bindPopup(e.popup),e.popup.jsmMPP=e),i&&(e.bgMarker=i,t.addLayer(i)),e.marker=a,t.addLayer(a)}catch(e){console.log("ERROR[_addPushpin]: "+e)}},JSMap.prototype._replayPushpins=function(e){if(null===this.replayPushpins)return this._clearReplay(),void jsmHighlightDetailRow(-1,!1);if(this.lastReplayMarker&&this.lastReplayMarker.isRunning())this._startReplayTimer(e,this.replayInterval);else{for(;;){if(this.replayIndex>=this.replayPushpins.length)return this._clearReplay(),jsmHighlightDetailRow(-1,!1),void(this.lastReplayMarker=null);if(geoIsValid((a=this.replayPushpins[this.replayIndex]).lat,a.lon)){if(0<AutoSkipRadius&&0<this.replayIndex&&this.replayIndex+1<this.replayPushpins.length){var t=this.replayPushpins[this.replayIndex-1];if(geoIsValid(t.lat,t.lon))if(geoDistanceMeters(a.lat,a.lon,t.lat,t.lon)<=AutoSkipRadius){this.replayIndex++;continue}}break}this.replayIndex++}try{var a,n=this.replayIndex-1;if((a=this.replayPushpins[this.replayIndex++]).hoverPopup=!1,REPLAY_SINGLE&&0<=n)try{this.markerLayer.clearLayers()}catch(e){}if(0<=n){var i=this.replayPushpins[n],s={heading:angleFromCoordinate(i.lat,i.lon,a.lat,a.lon)},o=jsmGetPushPinIcon(this.lastIconIdx,s),r=null;if(this.lastReplayMarker){r=this.lastReplayMarker;var l=L.icon({iconUrl:addBaseHrefToIconUrl(o.iconURL),iconSize:[o.iconSize[0],o.iconSize[1]],iconAnchor:[o.iconHotspot[0],o.iconHotspot[1]],popupAnchor:[0,3-o.iconHotspot[1]]});r.setIcon(l)}else{l=L.icon({iconUrl:addBaseHrefToIconUrl(o.iconURL),iconSize:[o.iconSize[0],o.iconSize[1]],iconAnchor:[o.iconHotspot[0],o.iconHotspot[1]],popupAnchor:[0,3-o.iconHotspot[1]]});r=L.marker(this._toLeafletPoint(a),{icon:l,clickable:!0,draggable:!1,title:"",zIndexOffset:10*a.ppNdx}),o.showDeviceLabel&&a.evRcd.device&&r.bindTooltip(a.evRcd.device,{permanent:!0,direction:"top"}),this.markerLayer.addLayer(r),this.lastReplayMarker=r}var p=!1;document.getElementById("ReplayMap").mapKeepAtCenter.checked&&(p=!0),r.slideTo([a.lat,a.lon],{duration:this.replayInterval,keepAtCenter:p})}e&&2<=e?this._showPushpinPopup(a):jsmHighlightDetailRow(a.rcdNdx,!0),this._startReplayTimer(e,this.replayInterval)}catch(e){console.log("ERROR[_replayPushpins]: "+e)}}},JSMap.prototype.JSShowPushpin=function(e,t){e&&(t&&this.JSSetCenter(new JSMapPoint(e.lat,e.lon)),this._showPushpinPopup(e))},JSMap.prototype._showPushpinPopup=function(e){this._hidePushpinPopup(),e&&e.marker.openPopup()},JSMap.prototype._hidePushpinPopup=function(){this.leafletMap.closePopup()},JSMap.prototype.JSDrawRoute=function(e,t){if(null!==e&&0<e.length){var a={points:e,color:t};this.routeLines||(this.routeLines=[]),this.routeLines.push(a);for(var n=[],i=0;i<this.routeLines.length;i++){var s=this.routeLines[i],o=this._createPolyline(s.points,s.color);null!=o&&n.push(o)}this._drawFeatures(!0,n)}},JSMap.prototype._createPolyline=function(e,t){return null!==e&&0<e.length?L.polyline(this._toLeafletPointArray(e),{stroke:!0,color:t,weight:2,opacity:1,lineCap:"round",lineJoin:"round",fill:!1}):null},JSMap.prototype._removeShapes=function(){this._clearDrawLayer(),this.drawShapes=[]},JSMap.prototype.JSDrawShape=function(e,t,a,n,i,s,o){if(!e||""==e||"!"==e)return this._removeShapes(),!1;if(e.startsWith("!")&&(this._removeShapes(),e=e.substr(1)),!a||0==a.length)return!1;n&&""!=n||(n="#0000FF");var r=i||0<=o?L.latLngBounds():null,l=new LeafletColorStyle(n,.75,n,.08),p=!1;if("circle"==e){for(var h=0;h<a.length;h++){var d=a[h],u=this._toLeafletPoint(d),c=this._createCircleFeature(u,t,l);r&&(r.extend(u),r.extend(this._toLeafletPoint(this._calcRadiusPoint(d,t,0))),r.extend(this._toLeafletPoint(this._calcRadiusPoint(d,t,90))),r.extend(this._toLeafletPoint(this._calcRadiusPoint(d,t,180))),r.extend(this._toLeafletPoint(this._calcRadiusPoint(d,t,270)))),this.drawShapes.push(c)}0<this.drawShapes.length&&(this._drawFeatures(!1,this.drawShapes),p=!0)}else if("rectangle"==e){if(2<=a.length){var _=a[0],m=a[1],g=this._toLeafletPointLatLon(_.lat>m.lat?_.lat:m.lat,_.lon<m.lon?_.lon:m.lon),E=this._toLeafletPointLatLon(_.lat>m.lat?_.lat:m.lat,_.lon>m.lon?_.lon:m.lon),f=this._toLeafletPointLatLon(_.lat<m.lat?_.lat:m.lat,_.lon<m.lon?_.lon:m.lon),S=[g,E,this._toLeafletPointLatLon(_.lat<m.lat?_.lat:m.lat,_.lon>m.lon?_.lon:m.lon),f,g],T=this._createPolygonFeature(S,l);if(r)for(var M=0;M<S.length;M++)r.extend(S[M]);this.drawShapes.push(T),this._drawFeatures(!1,this.drawShapes),p=!0}}else if("polygon"==e){if(3<=a.length){for(S=[],h=0;h<a.length;h++){var A=this._toLeafletPointLatLon(a[h].lat,a[h].lon);S.push(A),r&&r.extend(A)}T=this._createPolygonFeature(S,l);this.drawShapes.push(T),this._drawFeatures(!1,this.drawShapes),p=!0}}else if("corridor"==e);else if("center"==e&&r){for(h=0;h<a.length;h++){A=this._toLeafletPointLatLon(a[h].lat,a[h].lon);r.extend(A)}p=!0}if(p&&0<=o&&o<jsvPushpinIcon.length&&r){var v=r.getCenter(),D=jsvPushpinIcon[o];D.iconEval&&(D=jsvPushpinIcon[0]);var y=L.icon({iconUrl:D.iconUrl,iconSize:[D.iconSize[0],D.iconSize[1]],iconAnchor:[D.iconHotspot[0],D.iconHotspot[1]],popupAnchor:[0,3-D.iconHotspot[1]]}),C=L.marker(this._toLeafletPoint(D),{icon:y,clickable:!0,draggable:!1,title:""}),P=L.popup().setLatLng(this._toLeafletPoint(v)).setContent("<div class='geozoneMarker'>"+s+"&nbsp;&nbsp;</div>");this.leafletMap;C.bindPopup(P),this.markerLayer.addLayer(C),this.drawShapes.push(C)}if(p&&i&&r){var R=r.getCenter(),I=this.leafletMap.getBoundsZoom(r);try{this.leafletMap.setView(R,I)}catch(e){console.log("ERROR[JSDrawShape]: "+e)}}return p},JSMap.prototype.JSDrawGeozone=function(e,t,a,n,i){this._JSDrawGeozone(e,t,a,n,i,!1)},JSMap.prototype._JSDrawGeozone=function(e,t,a,n,i,s){if(jsvGeozoneMode=!0,s||(this.primaryCenter=null,this.primaryIndex=i),null===(this.geozonePoints=a)||a.length<=0)return this._clearDrawLayer(),null;if(e==ZONE_POINT_RADIUS){isNaN(t)&&(t=5e3),t>MAX_ZONE_RADIUS_M&&(t=MAX_ZONE_RADIUS_M),t<MIN_ZONE_RADIUS_M&&(t=MIN_ZONE_RADIUS_M),jsvZoneRadiusMeters=t;for(var o=0,r=new Array,l=L.latLngBounds(),p=[],h=0;h<a.length;h++){if(geoIsValid((g=a[h]).lat,g.lon)){var d=(E=h==i)&&s?this.primaryCenter:this._toLeafletPoint(g),u=GetGeozoneStyle(E,n);r.push(this._createCircleFeature(d,t,u)),E&&!s&&(this.primaryCenter=d),p.push(d),l.extend(d),l.extend(this._toLeafletPoint(this._calcRadiusPoint(g,t,0))),l.extend(this._toLeafletPoint(this._calcRadiusPoint(g,t,90))),l.extend(this._toLeafletPoint(this._calcRadiusPoint(g,t,180))),l.extend(this._toLeafletPoint(this._calcRadiusPoint(g,t,270))),o++}}if(!s){var c=this._toLeafletPoint(DEFAULT_CENTER),_=DEFAULT_ZOOM;0<o&&(c=l.getCenter(),_=this.leafletMap.getBoundsZoom(l));try{this.leafletMap.setView(c,_)}catch(e){console.log("ERROR[_JSDrawGeozone]: "+e)}}this._drawFeatures(!0,r)}else if(e==ZONE_POLYGON){jsvZoneRadiusMeters=t;for(o=0,r=new Array,l=L.latLngBounds(),p=[],h=0;h<a.length;h++){if(0!=(g=a[h]).lat||0!=g.lon){d=(E=h==i)&&s?this.primaryCenter:this._toLeafletPoint(g);E&&(this.primaryCenter=d,polyPtsPrim=p.length),p.push(d),l.extend(d),o++}}if(3<=p.length&&r.push(this._createPolygonFeature(p,GetGeozoneStyle(!1,n))),!s){c=this._toLeafletPoint(DEFAULT_CENTER),_=DEFAULT_ZOOM;0<o&&(c=l.getCenter(),_=this.leafletMap.getBoundsZoom(l));try{this.leafletMap.setView(c,_)}catch(e){console.log("ERROR[_JSDrawGeozone]: "+e)}}t=15*this._getMapResolution(),jsvZoneRadiusMeters=t;for(h=0;h<p.length;h++){d=p[h];var m=GetGeozoneStyle(h==polyPtsPrim,n);r.push(this._createCircleFeature(d,t,m))}this._drawFeatures(!0,r)}else if(e==ZONE_SWEPT_POINT_RADIUS){isNaN(t)&&(t=1e3),t>MAX_ZONE_RADIUS_M&&(t=MAX_ZONE_RADIUS_M),t<MIN_ZONE_RADIUS_M&&(t=MIN_ZONE_RADIUS_M),jsvZoneRadiusMeters=t;for(o=0,r=new Array,l=L.latLngBounds(),p=[],h=0;h<a.length;h++){var g;if(0!=(g=a[h]).lat||0!=g.lon){d=(E=h==i)&&s?this.primaryCenter:this._toLeafletPoint(g),u=GetGeozoneStyle(E,n);var E,f=this._createCircleFeature(d,t,u);r.push(f),E&&!s&&(this.primaryCenter=d),p.push(d),l.extend(d),l.extend(this._toLeafletPoint(this._calcRadiusPoint(g,t,0))),l.extend(this._toLeafletPoint(this._calcRadiusPoint(g,t,90))),l.extend(this._toLeafletPoint(this._calcRadiusPoint(g,t,180))),l.extend(this._toLeafletPoint(this._calcRadiusPoint(g,t,270))),o++}}if(2<=p.length)for(h=0;h<p.length-1;h++){var S=this._toJSMapPoint(p[h]),T=this._toJSMapPoint(p[h+1]),M=geoHeading(S.lat,S.lon,T.lat,T.lon)-90,A=[this._toLeafletPoint(this._calcRadiusPoint(S,t,M)),this._toLeafletPoint(this._calcRadiusPoint(T,t,M)),this._toLeafletPoint(this._calcRadiusPoint(T,t,M+180)),this._toLeafletPoint(this._calcRadiusPoint(S,t,M+180))];r.push(this._createPolygonFeature(A,GetGeozoneStyle(!1,n)))}if(!s){c=this._toLeafletPoint(DEFAULT_CENTER),_=DEFAULT_ZOOM;0<o&&(c=l.getCenter(),_=this.leafletMap.getBoundsZoom(l));try{this.leafletMap.setView(c,_)}catch(e){console.log("ERROR[_JSDrawGeozone]: "+e)}}this._drawFeatures(!0,r)}else alert("Geozone type not supported: "+e);return null},JSMap.prototype._createCircleFeature=function(e,t,a){return null!==e&&0<t?L.circle(e,{radius:t,stroke:!0,color:a.strokeColor,weight:a.strokeWidth,opacity:a.strokeOpacity,linkCap:"round",lineJoin:"round",fill:!0,fillColor:a.fillColor,fillOpacity:a.fillOpacity}):null},JSMap.prototype._calcRadiusPoint=function(e,t,a){var n=geoRadiusPoint(e.lat,e.lon,t,a);return new JSMapPoint(n.lat,n.lon)},JSMap.prototype._createPolygonFeature=function(e,t){return null!==e&&3<=e.length?L.polygon(e,{stroke:!0,color:t.strokeColor,weight:t.strokeWidth,opacity:t.strokeOpacity,lineCap:"round",lineJoin:"round",fill:!0,fillColor:t.fillColor,fillOpacity:t.fillOpacity,fillRule:"eventodd"}):null},JSMap.prototype._createGeometryPoint=function(e){return L.point(e.lat,e.lng)},JSMap.prototype._event_OnMouseDown=function(e){e.layerPoint;var t=e.latlng,a=e.originalEvent,n=this.keyShfPress,i=this.keyAltPress,s=this.keyCtlPress;if(i||s&&n)return!0;var o=this._toJSMapPoint(t);if(jsmapElem.style.cursor="crosshair",s)return this.dragType=DRAG_RULER,this._clearRulerLayer(!0),this.dragRulerStart=o,jsmSetDistanceDisplay(0),a.preventDefault(a),a.stopPropagation(a),this.leafletMap.dragging.disable(),!1;if(jsvGeozoneMode&&jsvZoneEditable){var r=zoneMapGetRadius(!1);if(null!==this.primaryCenter){var l=this._toJSMapPoint(this.primaryCenter);if(geoDistanceMeters(l.lat,l.lon,o.lat,o.lon)<=r)return n?(this.dragType=DRAG_GEOZONE_RADIUS,this._clearRulerLayer(!0)):(this.dragType=DRAG_GEOZONE_CENTER,this.dragZoneOffsetLat=o.lat-l.lat,this.dragZoneOffsetLon=o.lon-l.lon),a.preventDefault(a),a.stopPropagation(a),this.leafletMap.dragging.disable(),!1}if(!n&&this.geozonePoints&&0<this.geozonePoints.length)for(var p=0;p<this.geozonePoints.length;p++)if(geoDistanceMeters(this.geozonePoints[p].lat,this.geozonePoints[p].lon,o.lat,o.lon)<=r)return this.primaryIndex=p,this.primaryCenter=this.geozonePoints[p],zoneMapSetIndex(this.primaryIndex,!0),this._JSDrawGeozone(jsvZoneType,jsvZoneRadiusMeters,this.geozonePoints,jsvZoneColor,this.primaryIndex,!1),l=this._toJSMapPoint(this.primaryCenter),this.dragType=DRAG_GEOZONE_CENTER,this.dragZoneOffsetLat=o.lat-l.lat,this.dragZoneOffsetLon=o.lon-l.lon,a.preventDefault(a),a.stopPropagation(a),this.leafletMap.dragging.disable(),!1}return this.dragType=DRAG_NONE,this.leafletMap.dragging.enabled()||this.leafletMap.dragging.enable(),!0},JSMap.prototype._event_OnMouseUp=function(e){e.layerPoint,e.latlng;var t=e.originalEvent;this.keyShfPress,this.keyAltPress,this.keyCtlPress;if(jsvGeozoneMode&&0!=(this.dragType&DRAG_GEOZONE)){var a=this._toJSMapPoint(this.primaryCenter),n=zoneMapGetRadius(!1);return jsmSetPointZoneValue(a.lat,a.lon,n),this.dragType=DRAG_NONE,mapProviderParseZones(jsvZoneList),t.preventDefault(t),t.stopPropagation(t),this.leafletMap.dragging.enable(),!1}return this.dragType=DRAG_NONE,this.leafletMap.dragging.enabled()||this.leafletMap.dragging.enable(),!0},JSMap.prototype._event_OnMouseMove=function(e){e.layerPoint;var t=e.latlng,a=e.originalEvent,n=(this.keyShfPress,this.keyAltPress,this.keyCtlPress,this._toJSMapPoint(t));if(jsmSetLatLonDisplay(n.lat,n.lon),jsmapElem.style.cursor="crosshair",this.dragType==DRAG_RULER)return this.dragRulerEnd=n,jsmSetDistanceDisplay(geoDistanceMeters((i=this.dragRulerStart).lat,i.lon,n.lat,n.lon)),this._drawRuler([this._createRulerFeature(this.dragRulerStart,this.dragRulerEnd)]),a.preventDefault(a),a.stopPropagation(a),!1;if(this.dragType==DRAG_GEOZONE_RADIUS){var i=this._toJSMapPoint(this.primaryCenter);if(jsvZoneRadiusMeters=Math.round(geoDistanceMeters(i.lat,i.lon,n.lat,n.lon)),jsvZoneRadiusMeters>MAX_ZONE_RADIUS_M&&(jsvZoneRadiusMeters=MAX_ZONE_RADIUS_M),jsvZoneRadiusMeters<MIN_ZONE_RADIUS_M&&(jsvZoneRadiusMeters=MIN_ZONE_RADIUS_M),null!=(o=this._createCircleFeature(this.primaryCenter,jsvZoneRadiusMeters,GetGeozoneStyle(!0,jsvZoneColor)))){var s=[o];this._drawFeatures(!0,s),jsmSetDistanceDisplay(jsvZoneRadiusMeters)}return a.preventDefault(a),a.stopPropagation(a),!1}if(this.dragType==DRAG_GEOZONE_CENTER){i=new JSMapPoint(n.lat-this.dragZoneOffsetLat,n.lon-this.dragZoneOffsetLon);this.primaryCenter=this._toLeafletPoint(i);var o;return this._JSDrawGeozone(jsvZoneType,jsvZoneRadiusMeters,this.geozonePoints,jsvZoneColor,this.primaryIndex,!0),a.preventDefault(a),a.stopPropagation(a),!1}return!0},JSMap.prototype._event_OnClick=function(e){e.layerPoint;var t=e.latlng,a=e.originalEvent;if(jsvGeozoneMode&&jsvZoneEditable){var n=this._toJSMapPoint(t),i=null!==this.primaryCenter?this._toJSMapPoint(this.primaryCenter):new JSMapPoint(0,0),s=geoIsValid(i.lat,i.lon),o=geoDistanceMeters(i.lat,i.lon,n.lat,n.lon);if(jsvZoneType==ZONE_POINT_RADIUS){if(o<=(h=zoneMapGetRadius(!1)))return!1;if(this.geozonePoints&&0<this.geozonePoints.length)for(var r=0;r<this.geozonePoints.length;r++){if(r!=this.primaryIndex)if(geoDistanceMeters((S=this.geozonePoints[r]).lat,S.lon,n.lat,n.lon)<=h)return!1}return jsmSetPointZoneValue(n.lat,n.lon,h),mapProviderParseZones(jsvZoneList),a.preventDefault(a),a.stopPropagation(a),!0}if(jsvZoneType==ZONE_POLYGON){if(o<=(h=jsvZoneRadiusMeters))return!1;if(this.geozonePoints&&0<this.geozonePoints.length)for(r=0;r<this.geozonePoints.length;r++){if(r!=this.primaryIndex)if(geoDistanceMeters((S=this.geozonePoints[r]).lat,S.lon,n.lat,n.lon)<=h)return!1}for(var l=0,p=0;p<jsvZoneList.length;p++){geoIsValid((A=jsvZoneList[p]).lat,A.lon)&&l++}if(0==l){var h=450,d=geoRadians(n.lat),u=geoRadians(n.lon);for(p=0;p<jsvZoneList.length;p++){var c=p*(360/jsvZoneList.length),_=h/EARTH_RADIUS_METERS;(0==c||170<c&&c<190)&&(_*=.8);var m=geoRadians(c),g=Math.asin(Math.sin(d)*Math.cos(_)+Math.cos(d)*Math.sin(_)*Math.cos(m)),L=u+Math.atan2(Math.sin(m)*Math.sin(_)*Math.cos(d),Math.cos(_)-Math.sin(d)*Math.sin(g));_jsmSetPointZoneValue(p,geoDegrees(g),geoDegrees(L),0)}}else{var E=n.lat-i.lat,f=n.lon-i.lon;for(p=0;p<jsvZoneList.length;p++){geoIsValid((A=jsvZoneList[p]).lat,A.lon)&&_jsmSetPointZoneValue(p,A.lat+E,A.lon+f,0)}}return mapProviderParseZones(jsvZoneList),a.preventDefault(a),a.stopPropagation(a),!0}if(jsvZoneType==ZONE_SWEPT_POINT_RADIUS){if(o<=(h=jsvZoneRadiusMeters))return!1;if(this.geozonePoints&&0<this.geozonePoints.length)for(r=0;r<this.geozonePoints.length;r++){var S;if(r!=this.primaryIndex)if(geoDistanceMeters((S=this.geozonePoints[r]).lat,S.lon,n.lat,n.lon)<=h)return!1}l=0;var T=0,M=null;for(p=0;p<jsvZoneList.length;p++){var A;if(geoIsValid((A=jsvZoneList[p]).lat,A.lon))if(l++,null!==M){var v=geoDistanceMeters(M.lat,M.lon,A.lat,A.lon);T<v&&(T=v)}else M=A}return(!s||l<=0||o<=1.5*(5e3<T?T:5e3))&&jsmSetPointZoneValue(n.lat,n.lon,h),mapProviderParseZones(jsvZoneList),a.preventDefault(a),a.stopPropagation(a),!0}return!1}},JSMap.prototype._event_PopupOpen=function(e){var t=e.popup.jsmMPP;t&&jsmHighlightDetailRow(t.rcdNdx,!0)},JSMap.prototype._event_PopupClose=function(e){var t=e.popup.jsmMPP;t&&jsmHighlightDetailRow(t.rcdNdx,!1)},JSMap.prototype._event_ContextMenu=function(e){var t=e.latlng.lat.toFixed(5),a=e.latlng.lng.toFixed(5),n="<div id='jsmap_gz1' style='padding:0px; margin:0px; display:block;'>Create GeoZone</div>";n+="<div id='jsmap_gz2' style='padding:0px; margin:0px; display:block;'>",n+="<form id='jsmap_form_gz'>",n+="<table class='infoBoxTable' cellspacing='1' cellpadding='1' border='0'>",n+="<tr class='infoBoxRow'>",n+="<td class='infoBoxCell'><b>GeoZone Id:</b> <input type='text' id='z_newid' size=15 maxlength=20></td>",n+="</tr>",n+="<tr class='infoBoxRow'>",n+="<td class='infoBoxCell'><b>Location:</b>"+t+"/"+a+"</td>",n+="</tr>",n+="<tr class='infoBoxRow'>",n+="<td colspan='2' class='infoBoxCell'><b>GeoZone Name:</b> <input type='text' id='z_newname' size=15 maxlength=20></td>",n+="</tr>",n+="<tr class='infoBoxRow'>",n+="<td class='infoBoxCell'><b>Is Place Of Interest:</b> <input type='checkbox' id='z_ispoi' value='1'></td>",n+="<td class='infoBoxCell'><input type='button' id='create' value='Create' onclick=\"javascript:jsmPushPinGeoZoneSubmitForm();\"></td>",n+="</tr>",n+="<input type='hidden' id='z_lat0' value='"+t+"'></td></tr>",n+="<input type='hidden' id='z_lon0' value='"+a+"'></td></tr>",n+="</table>",n+="</form>",n+="</div>",null==this.geozonePopup&&(this.geozonePopup=L.popup()),this.geozonePopup.setLatLng(e.latlng).setContent(n).openOn(this.leafletMap)};